# Langchain-Chatchat

# ç›®å½•

é¡¹ç›®æ–‡æ¡£ç›®å½•

- FAQ.md
- [Install.md](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/docs/INSTALL.md)
- [åœ¨Anacondaä¸­ä½¿ç”¨pipå®‰è£…åŒ…çš„é—®é¢˜.md](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/docs/Issue-with-Installing-Packages-Using-pip-in-Anaconda.md)
- å‘é‡åº“ç¯å¢ƒ docker.md
- å¯åŠ¨APIæœåŠ¡.md
- [åœ¨Anacondaä¸­ä½¿ç”¨pipå®‰è£…åŒ…æ— æ•ˆé—®é¢˜.md](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/docs/%E5%9C%A8Anaconda%E4%B8%AD%E4%BD%BF%E7%94%A8pip%E5%AE%89%E8%A3%85%E5%8C%85%E6%97%A0%E6%95%88%E9%97%AE%E9%A2%98.md)

# é¡¹ç›®README

å‚è€ƒï¼šhttps://github.com/chatchat-space/Langchain-Chatchat

README ç›®å½•

- [ä»‹ç»](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#ä»‹ç»)
- [å˜æ›´æ—¥å¿—](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#å˜æ›´æ—¥å¿—)
- [æ¨¡å‹æ”¯æŒ](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#æ¨¡å‹æ”¯æŒ)
- [Docker éƒ¨ç½²](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#Docker-éƒ¨ç½²)
- å¼€å‘éƒ¨ç½²
  - [è½¯ä»¶éœ€æ±‚](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#è½¯ä»¶éœ€æ±‚)
  - [1. å¼€å‘ç¯å¢ƒå‡†å¤‡](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#1.-å¼€å‘ç¯å¢ƒå‡†å¤‡)
  - [2. ä¸‹è½½æ¨¡å‹è‡³æœ¬åœ°](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#2.-ä¸‹è½½æ¨¡å‹è‡³æœ¬åœ°)
  - [3. è®¾ç½®é…ç½®é¡¹](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#3.-è®¾ç½®é…ç½®é¡¹)
  - [4. çŸ¥è¯†åº“åˆå§‹åŒ–ä¸è¿ç§»](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#4.-çŸ¥è¯†åº“åˆå§‹åŒ–ä¸è¿ç§»)
  - [5. ä¸€é”®å¯åŠ¨APIæœåŠ¡æˆ–WebUIæœåŠ¡](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#6.-ä¸€é”®å¯åŠ¨)
  - [6. åˆ†æ­¥å¯åŠ¨ API æœåŠ¡æˆ– Web UI](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#5.-å¯åŠ¨-API-æœåŠ¡æˆ–-Web-UI)
- [å¸¸è§é—®é¢˜](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#å¸¸è§é—®é¢˜)
- [è·¯çº¿å›¾](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#è·¯çº¿å›¾)
- [é¡¹ç›®äº¤æµç¾¤](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#é¡¹ç›®äº¤æµç¾¤)

## ä»‹ç»

ğŸ¤–ï¸ ä¸€ç§åˆ©ç”¨ [langchain](https://github.com/hwchase17/langchain) æ€æƒ³å®ç°çš„åŸºäºæœ¬åœ°çŸ¥è¯†åº“çš„é—®ç­”åº”ç”¨ï¼Œç›®æ ‡æœŸæœ›å»ºç«‹ä¸€å¥—å¯¹ä¸­æ–‡åœºæ™¯ä¸å¼€æºæ¨¡å‹æ”¯æŒå‹å¥½ã€å¯ç¦»çº¿è¿è¡Œçš„çŸ¥è¯†åº“é—®ç­”è§£å†³æ–¹æ¡ˆã€‚

ğŸ’¡ å— [GanymedeNil](https://github.com/GanymedeNil) çš„é¡¹ç›® [document.ai](https://github.com/GanymedeNil/document.ai) å’Œ [AlexZhangji](https://github.com/AlexZhangji) åˆ›å»ºçš„ [ChatGLM-6B Pull Request](https://github.com/THUDM/ChatGLM-6B/pull/216) å¯å‘ï¼Œå»ºç«‹äº†å…¨æµç¨‹å¯ä½¿ç”¨å¼€æºæ¨¡å‹å®ç°çš„æœ¬åœ°çŸ¥è¯†åº“é—®ç­”åº”ç”¨ã€‚æœ¬é¡¹ç›®çš„æœ€æ–°ç‰ˆæœ¬ä¸­é€šè¿‡ä½¿ç”¨ [FastChat](https://github.com/lm-sys/FastChat) æ¥å…¥ Vicuna, Alpaca, LLaMA, Koala, RWKV ç­‰æ¨¡å‹ï¼Œä¾æ‰˜äº [langchain](https://github.com/langchain-ai/langchain) æ¡†æ¶æ”¯æŒé€šè¿‡åŸºäº [FastAPI](https://github.com/tiangolo/fastapi) æä¾›çš„ API è°ƒç”¨æœåŠ¡ï¼Œæˆ–ä½¿ç”¨åŸºäº [Streamlit](https://github.com/streamlit/streamlit) çš„ WebUI è¿›è¡Œæ“ä½œã€‚

âœ… ä¾æ‰˜äºæœ¬é¡¹ç›®æ”¯æŒçš„å¼€æº **LLM** ä¸ **Embedding** æ¨¡å‹ï¼Œæœ¬é¡¹ç›®å¯å®ç°å…¨éƒ¨ä½¿ç”¨**å¼€æº**æ¨¡å‹**ç¦»çº¿ç§æœ‰éƒ¨ç½²**ã€‚ä¸æ­¤åŒæ—¶ï¼Œæœ¬é¡¹ç›®ä¹Ÿæ”¯æŒ OpenAI GPT API çš„è°ƒç”¨ï¼Œå¹¶å°†åœ¨åç»­æŒç»­æ‰©å……å¯¹å„ç±»æ¨¡å‹åŠæ¨¡å‹ API çš„æ¥å…¥ã€‚
ï¼ˆæœ¯è¯­ï¼šLLM æ˜¯å¤§å‹è¯­è¨€æ¨¡å‹ï¼ŒEmbedding æ˜¯å‘é‡åº“æ˜ å°„ï¼‰

â›“ï¸ æœ¬é¡¹ç›®å®ç°åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿‡ç¨‹åŒ…æ‹¬åŠ è½½æ–‡ä»¶ -> è¯»å–æ–‡æœ¬ -> æ–‡æœ¬åˆ†å‰² -> æ–‡æœ¬å‘é‡åŒ– -> é—®å¥å‘é‡åŒ– -> åœ¨æ–‡æœ¬å‘é‡ä¸­åŒ¹é…å‡ºä¸é—®å¥å‘é‡æœ€ç›¸ä¼¼çš„ `top k`ä¸ª -> åŒ¹é…å‡ºçš„æ–‡æœ¬ä½œä¸ºä¸Šä¸‹æ–‡å’Œé—®é¢˜ä¸€èµ·æ·»åŠ åˆ° `prompt`ä¸­ -> æäº¤ç»™ `LLM`ç”Ÿæˆå›ç­”ã€‚

ğŸ“º [åŸç†ä»‹ç»è§†é¢‘](https://www.bilibili.com/video/BV13M4y1e7cN/?share_source=copy_web&vd_source=e6c5aafe684f30fbe41925d61ca6d514)

![image-20230906094634937](Langchain-Chatchat.assets/image-20230906094634937.png)

ä»æ–‡æ¡£å¤„ç†è§’åº¦æ¥çœ‹ï¼Œå®ç°æµç¨‹å¦‚ä¸‹ï¼š

![image-20230906094624349](Langchain-Chatchat.assets/image-20230906094624349.png)

ğŸš© æœ¬é¡¹ç›®æœªæ¶‰åŠå¾®è°ƒã€è®­ç»ƒè¿‡ç¨‹ï¼Œä½†å¯åˆ©ç”¨å¾®è°ƒæˆ–è®­ç»ƒå¯¹æœ¬é¡¹ç›®æ•ˆæœè¿›è¡Œä¼˜åŒ–ã€‚

ğŸŒ [AutoDL é•œåƒ](https://www.codewithgpu.com/i/imClumsyPanda/langchain-ChatGLM/Langchain-Chatchat) ä¸­ `v7` ç‰ˆæœ¬æ‰€ä½¿ç”¨ä»£ç å·²æ›´æ–°è‡³æœ¬é¡¹ç›® `v0.2.3` ç‰ˆæœ¬ã€‚

ğŸ³ [Docker é•œåƒ](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/registry.cn-beijing.aliyuncs.com/chatchat/chatchat:0.2.0)

ğŸ’» ä¸€è¡Œå‘½ä»¤è¿è¡Œ Dockerï¼š

```shell
docker run -d --gpus all -p 80:8501 registry.cn-beijing.aliyuncs.com/chatchat/chatchat:0.2.0
```

### æ¨¡å‹æ”¯æŒ

æœ¬é¡¹ç›®ä¸­é»˜è®¤ä½¿ç”¨çš„ LLM æ¨¡å‹ä¸º [THUDM/chatglm2-6b](https://huggingface.co/THUDM/chatglm2-6b)ï¼Œé»˜è®¤ä½¿ç”¨çš„ Embedding æ¨¡å‹ä¸º [moka-ai/m3e-base](https://huggingface.co/moka-ai/m3e-base) ä¸ºä¾‹ã€‚

#### LLM æ¨¡å‹æ”¯æŒ

æœ¬é¡¹ç›®æœ€æ–°ç‰ˆæœ¬ä¸­åŸºäº [FastChat](https://github.com/lm-sys/FastChat) è¿›è¡Œæœ¬åœ° LLM æ¨¡å‹æ¥å…¥ï¼Œæ”¯æŒæ¨¡å‹å¦‚ä¸‹ï¼š

- [meta-llama/Llama-2-7b-chat-hf](https://huggingface.co/meta-llama/Llama-2-7b-chat-hf)
- Vicuna, Alpaca, LLaMA, Koala
- [BlinkDL/RWKV-4-Raven](https://huggingface.co/BlinkDL/rwkv-4-raven)
- [camel-ai/CAMEL-13B-Combined-Data](https://huggingface.co/camel-ai/CAMEL-13B-Combined-Data)
- [databricks/dolly-v2-12b](https://huggingface.co/databricks/dolly-v2-12b)
- [FreedomIntelligence/phoenix-inst-chat-7b](https://huggingface.co/FreedomIntelligence/phoenix-inst-chat-7b)
- [h2oai/h2ogpt-gm-oasst1-en-2048-open-llama-7b](https://huggingface.co/h2oai/h2ogpt-gm-oasst1-en-2048-open-llama-7b)
- [lcw99/polyglot-ko-12.8b-chang-instruct-chat](https://huggingface.co/lcw99/polyglot-ko-12.8b-chang-instruct-chat)
- [lmsys/fastchat-t5-3b-v1.0](https://huggingface.co/lmsys/fastchat-t5)
- [mosaicml/mpt-7b-chat](https://huggingface.co/mosaicml/mpt-7b-chat)
- [Neutralzz/BiLLa-7B-SFT](https://huggingface.co/Neutralzz/BiLLa-7B-SFT)
- [nomic-ai/gpt4all-13b-snoozy](https://huggingface.co/nomic-ai/gpt4all-13b-snoozy)
- [NousResearch/Nous-Hermes-13b](https://huggingface.co/NousResearch/Nous-Hermes-13b)
- [openaccess-ai-collective/manticore-13b-chat-pyg](https://huggingface.co/openaccess-ai-collective/manticore-13b-chat-pyg)
- [OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5](https://huggingface.co/OpenAssistant/oasst-sft-4-pythia-12b-epoch-3.5)
- [project-baize/baize-v2-7b](https://huggingface.co/project-baize/baize-v2-7b)
- [Salesforce/codet5p-6b](https://huggingface.co/Salesforce/codet5p-6b)
- [StabilityAI/stablelm-tuned-alpha-7b](https://huggingface.co/stabilityai/stablelm-tuned-alpha-7b)
- [THUDM/chatglm-6b](https://huggingface.co/THUDM/chatglm-6b)
- [THUDM/chatglm2-6b](https://huggingface.co/THUDM/chatglm2-6b)
- [tiiuae/falcon-40b](https://huggingface.co/tiiuae/falcon-40b)
- [timdettmers/guanaco-33b-merged](https://huggingface.co/timdettmers/guanaco-33b-merged)
- [togethercomputer/RedPajama-INCITE-7B-Chat](https://huggingface.co/togethercomputer/RedPajama-INCITE-7B-Chat)
- [WizardLM/WizardLM-13B-V1.0](https://huggingface.co/WizardLM/WizardLM-13B-V1.0)
- [WizardLM/WizardCoder-15B-V1.0](https://huggingface.co/WizardLM/WizardCoder-15B-V1.0)
- [baichuan-inc/baichuan-7B](https://huggingface.co/baichuan-inc/baichuan-7B)
- [internlm/internlm-chat-7b](https://huggingface.co/internlm/internlm-chat-7b)
- [Qwen/Qwen-7B-Chat](https://huggingface.co/Qwen/Qwen-7B-Chat)
- [HuggingFaceH4/starchat-beta](https://huggingface.co/HuggingFaceH4/starchat-beta)
- ä»»ä½• [EleutherAI](https://huggingface.co/EleutherAI) çš„ pythia æ¨¡å‹ï¼Œå¦‚ [pythia-6.9b](https://huggingface.co/EleutherAI/pythia-6.9b)
- åœ¨ä»¥ä¸Šæ¨¡å‹åŸºç¡€ä¸Šè®­ç»ƒçš„ä»»ä½• [Peft](https://github.com/huggingface/peft) é€‚é…å™¨ã€‚ä¸ºäº†æ¿€æ´»ï¼Œæ¨¡å‹è·¯å¾„ä¸­å¿…é¡»æœ‰ `peft` ã€‚æ³¨æ„ï¼šå¦‚æœåŠ è½½å¤šä¸ªpeftæ¨¡å‹ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ä»»ä½•æ¨¡å‹å·¥ä½œå™¨ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ `PEFT_SHARE_BASE_WEIGHTS=true` æ¥ä½¿å®ƒä»¬å…±äº«åŸºç¡€æ¨¡å‹çš„æƒé‡ã€‚

ä»¥ä¸Šæ¨¡å‹æ”¯æŒåˆ—è¡¨å¯èƒ½éš [FastChat](https://github.com/lm-sys/FastChat) æ›´æ–°è€ŒæŒç»­æ›´æ–°ï¼Œå¯å‚è€ƒ [FastChat å·²æ”¯æŒæ¨¡å‹åˆ—è¡¨](https://github.com/lm-sys/FastChat/blob/main/docs/model_support.md)ã€‚

é™¤æœ¬åœ°æ¨¡å‹å¤–ï¼Œæœ¬é¡¹ç›®ä¹Ÿæ”¯æŒç›´æ¥æ¥å…¥ OpenAI APIï¼Œå…·ä½“è®¾ç½®å¯å‚è€ƒ `configs/model_configs.py.example` ä¸­çš„ `llm_model_dict` çš„ `openai-chatgpt-3.5` é…ç½®ä¿¡æ¯ã€‚

#### Embedding æ¨¡å‹æ”¯æŒ

æœ¬é¡¹ç›®æ”¯æŒè°ƒç”¨ [HuggingFace](https://huggingface.co/models?pipeline_tag=sentence-similarity) ä¸­çš„ Embedding æ¨¡å‹ï¼Œå·²æ”¯æŒçš„ Embedding æ¨¡å‹å¦‚ä¸‹ï¼š

- [moka-ai/m3e-small](https://huggingface.co/moka-ai/m3e-small)
- [moka-ai/m3e-base](https://huggingface.co/moka-ai/m3e-base)
- [moka-ai/m3e-large](https://huggingface.co/moka-ai/m3e-large)
- [BAAI/bge-small-zh](https://huggingface.co/BAAI/bge-small-zh)
- [BAAI/bge-base-zh](https://huggingface.co/BAAI/bge-base-zh)
- [BAAI/bge-large-zh](https://huggingface.co/BAAI/bge-large-zh)
- [BAAI/bge-large-zh-noinstruct](https://huggingface.co/BAAI/bge-large-zh-noinstruct)
- [shibing624/text2vec-base-chinese-sentence](https://huggingface.co/shibing624/text2vec-base-chinese-sentence)
- [shibing624/text2vec-base-chinese-paraphrase](https://huggingface.co/shibing624/text2vec-base-chinese-paraphrase)
- [shibing624/text2vec-base-multilingual](https://huggingface.co/shibing624/text2vec-base-multilingual)
- [shibing624/text2vec-base-chinese](https://huggingface.co/shibing624/text2vec-base-chinese)
- [shibing624/text2vec-bge-large-chinese](https://huggingface.co/shibing624/text2vec-bge-large-chinese)
- [GanymedeNil/text2vec-large-chinese](https://huggingface.co/GanymedeNil/text2vec-large-chinese)
- [nghuyong/ernie-3.0-nano-zh](https://huggingface.co/nghuyong/ernie-3.0-nano-zh)
- [nghuyong/ernie-3.0-base-zh](https://huggingface.co/nghuyong/ernie-3.0-base-zh)
- [OpenAI/text-embedding-ada-002](https://platform.openai.com/docs/guides/embeddings)

## Docker éƒ¨ç½²

ğŸ³ Docker é•œåƒåœ°å€: `registry.cn-beijing.aliyuncs.com/chatchat/chatchat:0.2.0)`

```bash
docker run -d --gpus all -p 80:8501 registry.cn-beijing.aliyuncs.com/chatchat/chatchat:0.2.0
```

- è¯¥ç‰ˆæœ¬é•œåƒå¤§å° `33.9GB`ï¼Œä½¿ç”¨ `v0.2.0`ï¼Œä»¥ `nvidia/cuda:12.1.1-cudnn8-devel-ubuntu22.04` ä¸ºåŸºç¡€é•œåƒ
- è¯¥ç‰ˆæœ¬å†…ç½®ä¸€ä¸ª `embedding` æ¨¡å‹ï¼š`m3e-large`ï¼Œå†…ç½® `chatglm2-6b-32k`
- è¯¥ç‰ˆæœ¬ç›®æ ‡ä¸ºæ–¹ä¾¿ä¸€é”®éƒ¨ç½²ä½¿ç”¨ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»åœ¨Linuxå‘è¡Œç‰ˆä¸Šå®‰è£…äº†NVIDIAé©±åŠ¨ç¨‹åº
- è¯·æ³¨æ„ï¼Œæ‚¨ä¸éœ€è¦åœ¨ä¸»æœºç³»ç»Ÿä¸Šå®‰è£…CUDAå·¥å…·åŒ…ï¼Œä½†éœ€è¦å®‰è£… `NVIDIA Driver` ä»¥åŠ `NVIDIA Container Toolkit`ï¼Œè¯·å‚è€ƒ[å®‰è£…æŒ‡å—](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html)
- é¦–æ¬¡æ‹‰å–å’Œå¯åŠ¨å‡éœ€è¦ä¸€å®šæ—¶é—´ï¼Œé¦–æ¬¡å¯åŠ¨æ—¶è¯·å‚ç…§ä¸‹å›¾ä½¿ç”¨ `docker logs -f <container id>` æŸ¥çœ‹æ—¥å¿—
- å¦‚é‡åˆ°å¯åŠ¨è¿‡ç¨‹å¡åœ¨ `Waiting..` æ­¥éª¤ï¼Œå»ºè®®ä½¿ç”¨ `docker exec -it <container id> bash` è¿›å…¥ `/logs/` ç›®å½•æŸ¥çœ‹å¯¹åº”é˜¶æ®µæ—¥å¿—

## å¼€å‘éƒ¨ç½²

### ç¯å¢ƒå‡†å¤‡

å¼€å‘ç¯å¢ƒå‡†å¤‡

æœ¬é¡¹ç›®å·²åœ¨ Python 3.8.1 - 3.10ï¼ŒCUDA 11.7 ç¯å¢ƒä¸‹å®Œæˆæµ‹è¯•ã€‚å·²åœ¨ Windowsã€ARM æ¶æ„çš„ macOSã€Linux ç³»ç»Ÿä¸­å®Œæˆæµ‹è¯•ã€‚

å‚è§ [å¼€å‘ç¯å¢ƒå‡†å¤‡](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/docs/INSTALL.md)ã€‚

**è¯·æ³¨æ„ï¼š** `0.2.0` åŠæ›´æ–°ç‰ˆæœ¬çš„ä¾èµ–åŒ…ä¸ `0.1.x` ç‰ˆæœ¬ä¾èµ–åŒ…å¯èƒ½å‘ç”Ÿå†²çªï¼Œå¼ºçƒˆå»ºè®®æ–°å»ºç¯å¢ƒåé‡æ–°å®‰è£…ä¾èµ–åŒ…ã€‚

#### ç¯å¢ƒæ£€æŸ¥

```bash
# é¦–å…ˆï¼Œç¡®ä¿¡ä½ çš„æœºå™¨å®‰è£…äº† Python 3.8 - 3.10 ç‰ˆæœ¬
$ python --version
Python 3.8.13

# å¦‚æœä½äºè¿™ä¸ªç‰ˆæœ¬ï¼Œå¯ä½¿ç”¨condaå®‰è£…ç¯å¢ƒ
$ conda create -p /your_path/env_name python=3.8

# æ¿€æ´»ç¯å¢ƒ
$ source activate /your_path/env_name

# æˆ–ï¼Œcondaå®‰è£…ï¼Œä¸æŒ‡å®šè·¯å¾„, æ³¨æ„ä»¥ä¸‹ï¼Œéƒ½å°†/your_path/env_nameæ›¿æ¢ä¸ºenv_name
$ conda create -n env_name python=3.8
$ conda activate env_name # Activate the environment

# æ›´æ–°pyåº“
$ pip3 install --upgrade pip

# å…³é—­ç¯å¢ƒ
$ source deactivate /your_path/env_name

# åˆ é™¤ç¯å¢ƒ
$ conda env remove -p  /your_path/env_name
```

#### é¡¹ç›®ä¾èµ–

```bash
# æ‹‰å–ä»“åº“
$ git clone https://github.com/chatchat-space/Langchain-Chatchat.git

# è¿›å…¥ç›®å½•
$ cd Langchain-Chatchat

# å®‰è£…ä¾èµ– (ä¸‰é€‰ä¸€ï¼Œä¸ºæ–¹ä¾¿ç”¨æˆ· API ä¸ webui åˆ†ç¦»è¿è¡Œï¼Œå¯å•ç‹¬æ ¹æ®è¿è¡Œéœ€æ±‚å®‰è£…ä¾èµ–åŒ…)
$ pip install -r requirements.txt # å®‰è£…å…¨éƒ¨ä¾èµ–
# $ pip install -r requirements_api.txt # å¦‚æœåªéœ€è¿è¡Œ API
# $ pip install -r requirements_webui.txt # å¦‚æœåªéœ€è¿è¡Œ WebUI

# é»˜è®¤ä¾èµ–åŒ…æ‹¬åŸºæœ¬è¿è¡Œç¯å¢ƒï¼ˆFAISSå‘é‡åº“ï¼‰ã€‚å¦‚æœè¦ä½¿ç”¨ milvus/pg_vector ç­‰å‘é‡åº“ï¼Œè¯·å°† requirements.txt ä¸­ç›¸åº”ä¾èµ–å–æ¶ˆæ³¨é‡Šå†å®‰è£…ã€‚
```

æ³¨ï¼šä½¿ç”¨ `langchain.document_loaders.UnstructuredFileLoader` è¿›è¡Œ `.docx` ç­‰æ ¼å¼éç»“æ„åŒ–æ–‡ä»¶æ¥å…¥æ—¶ï¼Œå¯èƒ½éœ€è¦ä¾æ®æ–‡æ¡£è¿›è¡Œå…¶ä»–ä¾èµ–åŒ…çš„å®‰è£…ï¼Œè¯·å‚è€ƒ [langchain æ–‡æ¡£](https://python.langchain.com/en/latest/modules/indexes/document_loaders/examples/unstructured_file.html)ã€‚

### æ¨¡å‹ä¸‹è½½ (LLM & Embedding)

ä¸‹è½½æ¨¡å‹è‡³æœ¬åœ°

å¦‚éœ€åœ¨æœ¬åœ°æˆ–ç¦»çº¿ç¯å¢ƒä¸‹è¿è¡Œæœ¬é¡¹ç›®ï¼Œéœ€è¦é¦–å…ˆå°†é¡¹ç›®æ‰€éœ€çš„æ¨¡å‹ä¸‹è½½è‡³æœ¬åœ°ï¼Œé€šå¸¸å¼€æº LLM ä¸ Embedding æ¨¡å‹å¯ä»¥ä» [HuggingFace](https://huggingface.co/models) ä¸‹è½½ã€‚

ä»¥æœ¬é¡¹ç›®ä¸­é»˜è®¤ä½¿ç”¨çš„ LLM æ¨¡å‹ [THUDM/chatglm2-6b](https://huggingface.co/THUDM/chatglm2-6b) ä¸ Embedding æ¨¡å‹ [moka-ai/m3e-base](https://huggingface.co/moka-ai/m3e-base) ä¸ºä¾‹ï¼š

ä¸‹è½½æ¨¡å‹éœ€è¦å…ˆ[å®‰è£…Git LFS](https://docs.github.com/zh/repositories/working-with-files/managing-large-files/installing-git-large-file-storage)ï¼Œç„¶åè¿è¡Œ

```bash
$ git clone https://huggingface.co/THUDM/chatglm2-6b
$ git clone https://huggingface.co/moka-ai/m3e-base
```

### é…ç½®é€‰é¡¹

è®¾ç½®é…ç½®é¡¹

å¤åˆ¶æ¨¡å‹ç›¸å…³å‚æ•°é…ç½®æ¨¡æ¿æ–‡ä»¶ [configs/model_config.py.example](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/configs/model_config.py.example) å­˜å‚¨è‡³é¡¹ç›®è·¯å¾„ä¸‹ `./configs` è·¯å¾„ä¸‹ï¼Œå¹¶é‡å‘½åä¸º `model_config.py`ã€‚

å¤åˆ¶æœåŠ¡ç›¸å…³å‚æ•°é…ç½®æ¨¡æ¿æ–‡ä»¶ [configs/server_config.py.example](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/configs/server_config.py.example) å­˜å‚¨è‡³é¡¹ç›®è·¯å¾„ä¸‹ `./configs` è·¯å¾„ä¸‹ï¼Œå¹¶é‡å‘½åä¸º `server_config.py`ã€‚

åœ¨å¼€å§‹æ‰§è¡Œ Web UI æˆ–å‘½ä»¤è¡Œäº¤äº’å‰ï¼Œè¯·å…ˆæ£€æŸ¥ `configs/model_config.py` å’Œ `configs/server_config.py` ä¸­çš„å„é¡¹æ¨¡å‹å‚æ•°è®¾è®¡æ˜¯å¦ç¬¦åˆéœ€æ±‚ï¼š

- è¯·ç¡®è®¤å·²ä¸‹è½½è‡³æœ¬åœ°çš„ LLM æ¨¡å‹æœ¬åœ°å­˜å‚¨è·¯å¾„å†™åœ¨ `llm_model_dict` å¯¹åº”æ¨¡å‹çš„ `local_model_path` å±æ€§ä¸­ï¼Œå¦‚:

  ```python
  llm_model_dict={
      "chatglm2-6b": {
          "local_model_path": "/Users/xxx/Downloads/chatglm2-6b",
          "api_base_url": "http://localhost:8888/v1",  # "name"ä¿®æ”¹ä¸º FastChat æœåŠ¡ä¸­çš„"api_base_url"
          "api_key": "EMPTY"
      },
  }
  ```

- è¯·ç¡®è®¤å·²ä¸‹è½½è‡³æœ¬åœ°çš„ Embedding æ¨¡å‹æœ¬åœ°å­˜å‚¨è·¯å¾„å†™åœ¨ `embedding_model_dict` å¯¹åº”æ¨¡å‹ä½ç½®ï¼Œå¦‚ï¼š

  ```python
  embedding_model_dict = {
      "m3e-base": "/Users/xxx/Downloads/m3e-base",
  }
  ```

å¦‚æœä½ é€‰æ‹©ä½¿ç”¨OpenAIçš„Embeddingæ¨¡å‹ï¼Œè¯·å°†æ¨¡å‹çš„ `key`å†™å…¥ `embedding_model_dict`ä¸­ã€‚ä½¿ç”¨è¯¥æ¨¡å‹ï¼Œä½ éœ€è¦èƒ½å¤Ÿè®¿é—®OpenAIå®˜çš„APIï¼Œæˆ–è®¾ç½®ä»£ç†ã€‚

### çŸ¥è¯†åº“åˆå§‹åŒ–ä¸è¿ç§»

å½“å‰é¡¹ç›®çš„çŸ¥è¯†åº“ä¿¡æ¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œåœ¨æ­£å¼è¿è¡Œé¡¹ç›®ä¹‹å‰è¯·å…ˆåˆå§‹åŒ–æ•°æ®åº“ï¼ˆæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åœ¨æ‰§è¡Œæ“ä½œå‰å¤‡ä»½æ‚¨çš„çŸ¥è¯†æ–‡ä»¶ï¼‰ã€‚

- å¦‚æœæ‚¨æ˜¯ä» `0.1.x` ç‰ˆæœ¬å‡çº§è¿‡æ¥çš„ç”¨æˆ·ï¼Œé’ˆå¯¹å·²å»ºç«‹çš„çŸ¥è¯†åº“ï¼Œè¯·ç¡®è®¤çŸ¥è¯†åº“çš„å‘é‡åº“ç±»å‹ã€Embedding æ¨¡å‹ä¸ `configs/model_config.py` ä¸­é»˜è®¤è®¾ç½®ä¸€è‡´ï¼Œå¦‚æ— å˜åŒ–åªéœ€ä»¥ä¸‹å‘½ä»¤å°†ç°æœ‰çŸ¥è¯†åº“ä¿¡æ¯æ·»åŠ åˆ°æ•°æ®åº“å³å¯ï¼š

  ```bash
  $ python init_database.py
  ```

- å¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œæœ¬é¡¹ç›®ï¼ŒçŸ¥è¯†åº“å°šæœªå»ºç«‹ï¼Œæˆ–è€…é…ç½®æ–‡ä»¶ä¸­çš„çŸ¥è¯†åº“ç±»å‹ã€åµŒå…¥æ¨¡å‹å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…ä¹‹å‰çš„å‘é‡åº“æ²¡æœ‰å¼€å¯ `normalize_L2`ï¼Œéœ€è¦ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–æˆ–é‡å»ºçŸ¥è¯†åº“ï¼š

  ```bash
  $ python init_database.py --recreate-vs
  ```

### ä¸€é”®å¯åŠ¨API æœåŠ¡æˆ– Web UI

#### å¯åŠ¨å‘½ä»¤

ä¸€é”®å¯åŠ¨è„šæœ¬ startup.py,ä¸€é”®å¯åŠ¨æ‰€æœ‰ Fastchat æœåŠ¡ã€API æœåŠ¡ã€WebUI æœåŠ¡ï¼Œç¤ºä¾‹ä»£ç ï¼š

```
$ python startup.py -a
```

å¹¶å¯ä½¿ç”¨ `Ctrl + C` ç›´æ¥å…³é—­æ‰€æœ‰è¿è¡ŒæœåŠ¡ã€‚å¦‚æœä¸€æ¬¡ç»“æŸä¸äº†ï¼Œå¯ä»¥å¤šæŒ‰å‡ æ¬¡ã€‚

å¯é€‰å‚æ•°åŒ…æ‹¬ `-a (æˆ–--all-webui)`, `--all-api`, `--llm-api`, `-c (æˆ–--controller)`, `--openai-api`, `-m (æˆ–--model-worker)`, `--api`, `--webui`ï¼Œå…¶ä¸­ï¼š

- `--all-webui` ä¸ºä¸€é”®å¯åŠ¨ WebUI æ‰€æœ‰ä¾èµ–æœåŠ¡ï¼›
- `--all-api` ä¸ºä¸€é”®å¯åŠ¨ API æ‰€æœ‰ä¾èµ–æœåŠ¡ï¼›
- `--llm-api` ä¸ºä¸€é”®å¯åŠ¨ Fastchat æ‰€æœ‰ä¾èµ–çš„ LLM æœåŠ¡ï¼›
- `--openai-api` ä¸ºä»…å¯åŠ¨ FastChat çš„ controller å’Œ openai-api-server æœåŠ¡ï¼›
- å…¶ä»–ä¸ºå•ç‹¬æœåŠ¡å¯åŠ¨é€‰é¡¹ã€‚

#### å¯åŠ¨éé»˜è®¤æ¨¡å‹

è‹¥æƒ³æŒ‡å®šéé»˜è®¤æ¨¡å‹ï¼Œéœ€è¦ç”¨ `--model-name` é€‰é¡¹ï¼Œç¤ºä¾‹ï¼š

```
$ python startup.py --all-webui --model-name Qwen-7B-Chat
```

æ›´å¤šä¿¡æ¯å¯é€šè¿‡ `python startup.py -h`æŸ¥çœ‹ã€‚

#### å¤šå¡åŠ è½½

é¡¹ç›®æ”¯æŒå¤šå¡åŠ è½½ï¼Œéœ€åœ¨ startup.py ä¸­çš„ create_model_worker_app å‡½æ•°ä¸­ï¼Œä¿®æ”¹å¦‚ä¸‹ä¸‰ä¸ªå‚æ•°:

```
gpus=None, 
num_gpus=1, 
max_gpu_memory="20GiB"
```

å…¶ä¸­ï¼Œ`gpus` æ§åˆ¶ä½¿ç”¨çš„æ˜¾å¡çš„IDï¼Œä¾‹å¦‚ "0,1";

`num_gpus` æ§åˆ¶ä½¿ç”¨çš„å¡æ•°;

`max_gpu_memory` æ§åˆ¶æ¯ä¸ªå¡ä½¿ç”¨çš„æ˜¾å­˜å®¹é‡ã€‚

æ³¨1ï¼šserver_config.pyçš„FSCHAT_MODEL_WORKERSå­—å…¸ä¸­ä¹Ÿå¢åŠ äº†ç›¸å…³é…ç½®ï¼Œå¦‚æœ‰éœ€è¦ä¹Ÿå¯é€šè¿‡ä¿®æ”¹FSCHAT_MODEL_WORKERSå­—å…¸ä¸­å¯¹åº”å‚æ•°å®ç°å¤šå¡åŠ è½½ã€‚

æ³¨2ï¼šå°‘æ•°æƒ…å†µä¸‹ï¼Œgpuså‚æ•°ä¼šä¸ç”Ÿæ•ˆï¼Œæ­¤æ—¶éœ€è¦é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡CUDA_VISIBLE_DEVICESæ¥æŒ‡å®štorchå¯è§çš„gpu,ç¤ºä¾‹ä»£ç ï¼š

```
CUDA_VISIBLE_DEVICES=0,1 python startup.py 
```

#### PEFT åŠ è½½(åŒ…æ‹¬lora,p-tuning,prefix tuning, prompt tuning,ia3ç­‰)

æœ¬é¡¹ç›®åŸºäº FastChat åŠ è½½ LLM æœåŠ¡ï¼Œæ•…éœ€ä»¥ FastChat åŠ è½½ PEFT  è·¯å¾„ï¼Œå³ä¿è¯è·¯å¾„åç§°é‡Œå¿…é¡»æœ‰ peft è¿™ä¸ªè¯ï¼Œé…ç½®æ–‡ä»¶çš„åå­—ä¸º adapter_config.jsonï¼Œpeft è·¯å¾„ä¸‹åŒ…å«.bin æ ¼å¼çš„  PEFT  æƒé‡ï¼Œpeftè·¯å¾„åœ¨startup.pyä¸­create_model_worker_appå‡½æ•°çš„args.model_namesä¸­æŒ‡å®šï¼Œå¹¶å¼€å¯ç¯å¢ƒå˜é‡PEFT_SHARE_BASE_WEIGHTS=trueå‚æ•°ã€‚

æ³¨ï¼šå¦‚æœä¸Šè¿°æ–¹å¼å¯åŠ¨å¤±è´¥ï¼Œåˆ™éœ€è¦ä»¥æ ‡å‡†çš„fastchatæœåŠ¡å¯åŠ¨æ–¹å¼åˆ†æ­¥å¯åŠ¨ï¼Œåˆ†æ­¥å¯åŠ¨æ­¥éª¤å‚è€ƒç¬¬å…­èŠ‚ï¼ŒPEFTåŠ è½½è¯¦ç»†æ­¥éª¤å‚è€ƒ[åŠ è½½loraå¾®è°ƒåæ¨¡å‹å¤±æ•ˆ](https://github.com/chatchat-space/Langchain-Chatchat/issues/1130#issuecomment-1685291822)ï¼Œ

#### **æ³¨æ„äº‹é¡¹**

**1. startup è„šæœ¬ç”¨å¤šè¿›ç¨‹æ–¹å¼å¯åŠ¨å„æ¨¡å—çš„æœåŠ¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ‰“å°é¡ºåºé—®é¢˜ï¼Œè¯·ç­‰å¾…å…¨éƒ¨æœåŠ¡å‘èµ·åå†è°ƒç”¨ï¼Œå¹¶æ ¹æ®é»˜è®¤æˆ–æŒ‡å®šç«¯å£è°ƒç”¨æœåŠ¡ï¼ˆé»˜è®¤ LLM API æœåŠ¡ç«¯å£ï¼š`127.0.0.1:8888`,é»˜è®¤ API æœåŠ¡ç«¯å£ï¼š`127.0.0.1:7861`,é»˜è®¤ WebUI æœåŠ¡ç«¯å£ï¼š`æœ¬æœºIPï¼š8501`)**

**2.æœåŠ¡å¯åŠ¨æ—¶é—´ç¤ºè®¾å¤‡ä¸åŒè€Œä¸åŒï¼Œçº¦ 3-10 åˆ†é’Ÿï¼Œå¦‚é•¿æ—¶é—´æ²¡æœ‰å¯åŠ¨è¯·å‰å¾€ `./logs`ç›®å½•ä¸‹ç›‘æ§æ—¥å¿—ï¼Œå®šä½é—®é¢˜ã€‚**

**3. åœ¨Linuxä¸Šä½¿ç”¨ctrl+Cé€€å‡ºå¯èƒ½ä¼šç”±äºlinuxçš„å¤šè¿›ç¨‹æœºåˆ¶å¯¼è‡´multiprocessingé—ç•™å­¤å„¿è¿›ç¨‹ï¼Œå¯é€šè¿‡shutdown_all.shè¿›è¡Œé€€å‡º**

#### å¯åŠ¨ç•Œé¢ç¤ºä¾‹

1. FastAPI docs ç•Œé¢

![image-20230906095433786](Langchain-Chatchat.assets/image-20230906095433786.png)

2. webuiå¯åŠ¨ç•Œé¢ç¤ºä¾‹ï¼š

- Web UI å¯¹è¯ç•Œé¢ï¼š [![img](https://github.com/chatchat-space/Langchain-Chatchat/raw/master/img/webui_0813_0.png)](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/img/webui_0813_0.png)
- Web UI çŸ¥è¯†åº“ç®¡ç†é¡µé¢ï¼š [![img](Langchain-Chatchat.assets/webui_0813_1.png)](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/img/webui_0813_1.png)

### åˆ†æ­¥å¯åŠ¨ API æœåŠ¡æˆ– Web UIï¼ˆä¸€é”®å¯åŠ¨å¿½ç•¥æœ¬èŠ‚ï¼‰

æ³¨æ„ï¼šå¦‚ä½¿ç”¨äº†ä¸€é”®å¯åŠ¨æ–¹å¼ï¼Œå¯å¿½ç•¥æœ¬èŠ‚ã€‚

#### å¯åŠ¨ LLM æœåŠ¡ (ä¸‰ç§æ–¹å¼)

å¦‚éœ€ä½¿ç”¨å¼€æºæ¨¡å‹è¿›è¡Œæœ¬åœ°éƒ¨ç½²ï¼Œéœ€é¦–å…ˆå¯åŠ¨ LLM æœåŠ¡ï¼Œå¯åŠ¨æ–¹å¼åˆ†ä¸ºä¸‰ç§ï¼š

- [åŸºäºå¤šè¿›ç¨‹è„šæœ¬ llm_api.py å¯åŠ¨ LLM æœåŠ¡](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#5.1.1-åŸºäºå¤šè¿›ç¨‹è„šæœ¬-llm_api.py-å¯åŠ¨-LLM-æœåŠ¡)
- [åŸºäºå‘½ä»¤è¡Œè„šæœ¬ llm_api_stale.py å¯åŠ¨ LLM æœåŠ¡](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#5.1.2-åŸºäºå‘½ä»¤è¡Œè„šæœ¬-llm_api_stale.py-å¯åŠ¨-LLM-æœåŠ¡)
- [PEFT åŠ è½½](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#5.1.3-PEFT-åŠ è½½)

ä¸‰ç§æ–¹å¼åªéœ€é€‰æ‹©ä¸€ä¸ªå³å¯ï¼Œå…·ä½“æ“ä½œæ–¹å¼è¯¦è§ 5.1.1 - 5.1.3ã€‚

å¦‚æœå¯åŠ¨åœ¨çº¿çš„APIæœåŠ¡ï¼ˆå¦‚ OPENAI çš„ API æ¥å£ï¼‰ï¼Œåˆ™æ— éœ€å¯åŠ¨ LLM æœåŠ¡ï¼Œå³ 5.1 å°èŠ‚çš„ä»»ä½•å‘½ä»¤å‡æ— éœ€å¯åŠ¨ã€‚

##### åŸºäºå¤šè¿›ç¨‹è„šæœ¬ llm_api.py å¯åŠ¨ LLM æœåŠ¡

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ [server/llm_api.py](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/server/llm_api.py) è„šæœ¬å¯åŠ¨ **LLM æ¨¡å‹**æœåŠ¡ï¼š

```
$ python server/llm_api.py
```

é¡¹ç›®æ”¯æŒå¤šå¡åŠ è½½ï¼Œéœ€åœ¨ llm_api.py ä¸­çš„ create_model_worker_app å‡½æ•°ä¸­ï¼Œä¿®æ”¹å¦‚ä¸‹ä¸‰ä¸ªå‚æ•°:

```
gpus=None, 
num_gpus=1, 
max_gpu_memory="20GiB"
```

å…¶ä¸­ï¼Œ`gpus` æ§åˆ¶ä½¿ç”¨çš„æ˜¾å¡çš„IDï¼Œå¦‚æœ "0,1";

`num_gpus` æ§åˆ¶ä½¿ç”¨çš„å¡æ•°;

`max_gpu_memory` æ§åˆ¶æ¯ä¸ªå¡ä½¿ç”¨çš„æ˜¾å­˜å®¹é‡ã€‚

##### åŸºäºå‘½ä»¤è¡Œè„šæœ¬ llm_api_stale.py å¯åŠ¨ LLM æœåŠ¡

âš ï¸ **æ³¨æ„:**

**1.llm_api_stale.pyè„šæœ¬åŸç”Ÿä»…é€‚ç”¨äºlinuxã€‚macè®¾å¤‡éœ€è¦å®‰è£…å¯¹åº”çš„linuxå‘½ä»¤ï¼Œwinå¹³å°è¯·ä½¿ç”¨wsl;**

**2.åŠ è½½éé»˜è®¤æ¨¡å‹éœ€è¦ç”¨å‘½ä»¤è¡Œå‚æ•°--model-path-addressæŒ‡å®šæ¨¡å‹ï¼Œä¸ä¼šè¯»å–model_config.pyé…ç½®;**

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ [server/llm_api_stale.py](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/server/llm_api_stale.py) è„šæœ¬å¯åŠ¨ **LLM æ¨¡å‹**æœåŠ¡ï¼š

```bash
$ python server/llm_api_stale.py
```

è¯¥æ–¹å¼æ”¯æŒå¯åŠ¨å¤šä¸ªworkerï¼Œç¤ºä¾‹å¯åŠ¨æ–¹å¼ï¼š

```bash
$ python server/llm_api_stale.py --model-path-address model1@host1@port1 model2@host2@port2
```

å¦‚æœå‡ºç°serverç«¯å£å ç”¨æƒ…å†µï¼Œéœ€æ‰‹åŠ¨æŒ‡å®šserverç«¯å£,å¹¶åŒæ­¥ä¿®æ”¹model_config.pyä¸‹å¯¹åº”æ¨¡å‹çš„base_api_urlä¸ºæŒ‡å®šç«¯å£:

```bash
$ python server/llm_api_stale.py --server-port 8887
```

å¦‚æœè¦å¯åŠ¨å¤šå¡åŠ è½½ï¼Œç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
$ python server/llm_api_stale.py --gpus 0,1 --num-gpus 2 --max-gpu-memory 10GiB
```

æ³¨ï¼šä»¥å¦‚ä¸Šæ–¹å¼å¯åŠ¨LLMæœåŠ¡ä¼šä»¥nohupå‘½ä»¤åœ¨åå°è¿è¡Œ FastChat æœåŠ¡ï¼Œå¦‚éœ€åœæ­¢æœåŠ¡ï¼Œå¯ä»¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```bash
$ python server/llm_api_shutdown.py --serve all 
```

äº¦å¯å•ç‹¬åœæ­¢ä¸€ä¸ª FastChat æœåŠ¡æ¨¡å—ï¼Œå¯é€‰ [`all`, `controller`, `model_worker`, `openai_api_server`]

##### PEFT åŠ è½½(åŒ…æ‹¬lora,p-tuning,prefix tuning, prompt tuning,ia3ç­‰)

æœ¬é¡¹ç›®åŸºäº FastChat åŠ è½½ LLM æœåŠ¡ï¼Œæ•…éœ€ä»¥ FastChat åŠ è½½ PEFT  è·¯å¾„ï¼Œå³ä¿è¯è·¯å¾„åç§°é‡Œå¿…é¡»æœ‰ peft è¿™ä¸ªè¯ï¼Œé…ç½®æ–‡ä»¶çš„åå­—ä¸º adapter_config.jsonï¼Œpeft è·¯å¾„ä¸‹åŒ…å«  model.bin æ ¼å¼çš„ PEFT æƒé‡ã€‚ è¯¦ç»†æ­¥éª¤å‚è€ƒ[åŠ è½½loraå¾®è°ƒåæ¨¡å‹å¤±æ•ˆ](https://github.com/chatchat-space/Langchain-Chatchat/issues/1130#issuecomment-1685291822)

![image-20230906100313064](Langchain-Chatchat.assets/image-20230906100313064.png)

#### å¯åŠ¨ API æœåŠ¡

æœ¬åœ°éƒ¨ç½²æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§ [5.1 èŠ‚](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#5.1-å¯åŠ¨-LLM-æœåŠ¡)**å¯åŠ¨ LLM æœåŠ¡å**ï¼Œå†æ‰§è¡Œ [server/api.py](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/server/api.py) è„šæœ¬å¯åŠ¨ **API** æœåŠ¡ï¼›

åœ¨çº¿è°ƒç”¨APIæœåŠ¡çš„æƒ…å†µä¸‹ï¼Œç›´æ¥æ‰§æ‰§è¡Œ [server/api.py](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/server/api.py) è„šæœ¬å¯åŠ¨ **API** æœåŠ¡ï¼›

è°ƒç”¨å‘½ä»¤ç¤ºä¾‹ï¼š

```bash
$ python server/api.py
```

å¯åŠ¨ API æœåŠ¡åï¼Œå¯è®¿é—® `localhost:7861` æˆ– `{API æ‰€åœ¨æœåŠ¡å™¨ IP}:7861` FastAPI è‡ªåŠ¨ç”Ÿæˆçš„ docs è¿›è¡Œæ¥å£æŸ¥çœ‹ä¸æµ‹è¯•ã€‚

- FastAPI docs ç•Œé¢
  ![image-20230906100403529](Langchain-Chatchat.assets/image-20230906100403529.png)

#### å¯åŠ¨ Web UI æœåŠ¡

æŒ‰ç…§ [5.2 èŠ‚](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/README.md#5.2-å¯åŠ¨-API-æœåŠ¡)**å¯åŠ¨ API æœåŠ¡å**ï¼Œæ‰§è¡Œ [webui.py](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/webui.py) å¯åŠ¨ **Web UI** æœåŠ¡ï¼ˆé»˜è®¤ä½¿ç”¨ç«¯å£ `8501`ï¼‰

```bash
$ streamlit run webui.py
```

ä½¿ç”¨ Langchain-Chatchat ä¸»é¢˜è‰²å¯åŠ¨ **Web UI** æœåŠ¡ï¼ˆé»˜è®¤ä½¿ç”¨ç«¯å£ `8501`ï¼‰

```bash
$ streamlit run webui.py --theme.base "light" --theme.primaryColor "#165dff" --theme.secondaryBackgroundColor "#f5f5f5" --theme.textColor "#000000"
```

æˆ–ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŒ‡å®šå¯åŠ¨ **Web UI** æœåŠ¡å¹¶æŒ‡å®šç«¯å£å·

```bash
$ streamlit run webui.py --server.port 666
```

- Web UI å¯¹è¯ç•Œé¢ï¼š

  [![img](https://github.com/chatchat-space/Langchain-Chatchat/raw/master/img/webui_0813_0.png)](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/img/webui_0813_0.png)

- Web UI çŸ¥è¯†åº“ç®¡ç†é¡µé¢ï¼š

  [![img](https://github.com/chatchat-space/Langchain-Chatchat/raw/master/img/webui_0813_1.png)](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/img/webui_0813_1.png)

## å¸¸è§é—®é¢˜

å‚è§ [å¸¸è§é—®é¢˜](https://github.com/chatchat-space/Langchain-Chatchat/blob/master/docs/FAQ.md)ã€‚

## è·¯çº¿å›¾

-  Langchain åº”ç”¨
  -  æœ¬åœ°æ•°æ®æ¥å…¥
    -  æ¥å…¥éç»“æ„åŒ–æ–‡æ¡£
      -  .md
      -  .txt
      -  .docx
    -  ç»“æ„åŒ–æ•°æ®æ¥å…¥
      -  .csv
      -  .xlsx
    -  åˆ†è¯åŠå¬å›
      -  æ¥å…¥ä¸åŒç±»å‹ TextSplitter
      -  ä¼˜åŒ–ä¾æ®ä¸­æ–‡æ ‡ç‚¹ç¬¦å·è®¾è®¡çš„ ChineseTextSplitter
      -  é‡æ–°å®ç°ä¸Šä¸‹æ–‡æ‹¼æ¥å¬å›
    -  æœ¬åœ°ç½‘é¡µæ¥å…¥
    -  SQL æ¥å…¥
    -  çŸ¥è¯†å›¾è°±/å›¾æ•°æ®åº“æ¥å…¥
  -  æœç´¢å¼•æ“æ¥å…¥
    -  Bing æœç´¢
    -  DuckDuckGo æœç´¢
  -  Agent å®ç°
-  LLM æ¨¡å‹æ¥å…¥
  -  æ”¯æŒé€šè¿‡è°ƒç”¨ [FastChat](https://github.com/lm-sys/fastchat) api è°ƒç”¨ llm
  -  æ”¯æŒ ChatGLM API ç­‰ LLM API çš„æ¥å…¥
-  Embedding æ¨¡å‹æ¥å…¥
  -  æ”¯æŒè°ƒç”¨ HuggingFace ä¸­å„å¼€æº Emebdding æ¨¡å‹
  -  æ”¯æŒ OpenAI Embedding API ç­‰ Embedding API çš„æ¥å…¥
-  åŸºäº FastAPI çš„ API æ–¹å¼è°ƒç”¨
-  Web UI
  -  åŸºäº Streamlit çš„ Web UI

## é¡¹ç›®äº¤æµç¾¤

<img src="./Langchain-Chatchat.assets/image-20230906101805804.png" alt="image-20230906101805804" style="zoom:25%;" />

# ä¸ªäººç¯å¢ƒå¤‡æ³¨

## LLMæ¨¡å‹æ›¿æ¢é—®é¢˜

### æ¢ç”¨æ›´å¤§å‚æ•°é‡çš„æ¨¡å‹

ä»–è¿™é‡Œé»˜è®¤æ˜¯6bï¼Œå¯ä»¥ç»™7Gçš„æ˜¾å¡ç”¨ã€‚ä½†å…¬å¸ç”µè„‘æ˜¯24Gæ˜¾å­˜çš„3090Tiï¼Œå¯ä»¥æ¢ç”¨æ›´å¼ºçš„æœ¬åœ°æ¨¡å‹ã€‚
è¿™é‡Œå¤§æ¦‚ç®—ä¸€ä¸‹ï¼Œbå°±æ˜¯billion åäº¿ã€‚ $7G=7*10^{3*3}=7B$ï¼Œç”±äºå…¶ä»–æŸè€—å°±å¤§æ¦‚æ˜¯7Gæ˜¾å¡çš„æ ·å­ã€‚
ä½†è¿™ä¹Ÿä¸ä¸€å®šï¼Œåƒ https://zhuanlan.zhihu.com/p/618690572 è¿™é‡Œè¯´è¿™ä¸ª130Bç¼©æ”¾ç‰¹æ€§å¯ä»¥é‡åŒ–åˆ°100Bçº§åˆ«ï¼Œç„¶åå¯ä»¥ç”± 4x24G æ¥è¿è¡Œ

å‚è€ƒï¼š

- GPT-3 175B
- OPT-175B
- BLOOM-176B

### åŒå‚æ•°é‡çš„æ¨¡å‹ã€é‡åŒ–oré«˜å‚æ•°é‡

å¦å¤–ï¼Œå‚æ•°é‡ç›¸åŒçš„æ¨¡å‹ä¹Ÿä¼šæœ‰å·®å¼‚ã€‚å¦‚æ–°çš„ä¼˜åŒ–æ–¹æ¡ˆå¯¼è‡´æ€§èƒ½ä¸åŒï¼Œæˆ–è€…è®­ç»ƒé›†ä¸åŒï¼Œè°ƒå‚å·®å¼‚ï¼Œå¯¼è‡´çš„ä¾§é‡ç‚¹ä¸åŒã€‚ä»¥åŠåŒè¯­çš„æ”¯æŒç­‰ï¼Œéƒ½æ˜¯è¦è€ƒè™‘çš„é‡ç‚¹ã€‚

å‚è€ƒï¼š[ä¸­æ–‡ç¾Šé©¼å¤§æ¨¡å‹Alpaca-Plus-13Bã€Alpaca-33Bæ•ˆæœå¤§æ¯”æ‹¼](https://blog.csdn.net/nlpstarter/article/details/131129240)

æ¨¡å‹æ¯”è¾ƒ

- Alpaca-Plus-13Bï¼š120Gé¢„è®­ç»ƒï¼Œ400ä¸‡æŒ‡ä»¤ç²¾è°ƒã€‚
  - ç‰¹ç‚¹ï¼šé«˜è®­ç»ƒæ•°æ®ï¼ŒQ8é‡åŒ–
- Alpaca-33Bï¼š20Gé¢„è®­ç»ƒï¼Œ400ä¸‡æŒ‡ä»¤ç²¾è°ƒ
  - ç‰¹ç‚¹ï¼šæ¨¡å‹é‡çº§å¤§ï¼ŒQ4é‡åŒ–

æµ‹è¯•

- æ¸©å®¤æ•ˆåº”é—®é¢˜ï¼š33Bçš„å›ç­”æ¯”è¾ƒç®€ç»ƒï¼Œå†…å®¹é•¿åº¦ä¸Šä¸å ä¼˜
- æ•°å­¦é—®é¢˜ï¼šéª‘7ä¸ªçŒ´ã€‚**33Bçš„å®Œèƒœ**Plus-13Bï¼Œå¯èƒ½æ¨¡å‹é‡çº§å¯¹äºè¿™ç§æ•°å€¼è®¡ç®—å’Œæ¨ç†ç±»çš„æœ‰è¾ƒå¤§ä¼˜åŠ¿å§
- å¦‚ä½•åˆ¶ä½œå®«ä¿é¸¡ä¸ï¼Ÿï¼šå·®ä¸å¤š
- å†™ä¸€å°ä¿¡ï¼šPlus-13Bå ä¼˜ä¸€äº›ï¼Œå†…å®¹è¯¦å®ã€‚å¯èƒ½33Båƒäº†è®­ç»ƒæ•°æ®å°‘çš„äºï¼Œå†™çš„å†…å®¹ä¸æ˜¯ç‰¹åˆ«ç”ŸåŠ¨
- ä»£ç æ–¹é¢ï¼š**33Bæ˜¾è‘—èƒœå‡º**
- è§’è‰²æ‰®æ¼”ï¼šå·®ä¸å¤šï¼Œ13å›å¤é•¿ï¼Œç•¥ä¼˜

æ€»ç»“

> Plus-13Bç›¸æ¯”ä¹‹å‰çš„7B/13Bå·²ç»æœ‰æ˜¾è‘—æ€§èƒ½æå‡äº†ï¼Œå°¤å…¶æ˜¯åœ¨ç”Ÿæˆç±»çš„ä»»åŠ¡ä¸Šå†…å®¹æ›´åŠ è¯¦å®ã€‚33Bçš„ä¼˜ç¼ºç‚¹æ¯”è¾ƒæ˜æ˜¾ï¼Œä¼˜ç‚¹æ˜¯ä»£ç èƒ½åŠ›å’Œæ•°å€¼è®¡ç®—æ–¹é¢ç¡®å®æ¯”ä¹‹å‰é«˜å‡ºä¸€æˆªï¼Œä½†æ˜¯åœ¨æ–‡æœ¬ç”Ÿæˆç±»çš„ä»»åŠ¡ä¸Šæ•ˆæœç•¥ä½äºplus-13Bã€‚ä¸è¿‡33Bæ˜¯åŸºç¡€ç‰ˆï¼Œè¿™ä¹ˆæ¯”å¯èƒ½æœ‰ç‚¹ä¸è®²æ­¦å¾·ï¼Œå“ˆå“ˆã€‚è¿™æ ·å…¶å®å°±æ¯”è¾ƒæœŸå¾…åç»­plus-33bçš„æ•ˆæœäº†ï¼Œç”Ÿæˆç±»ä»»åŠ¡çš„æ•ˆæœåº”è¯¥ä¼šæœ‰ä¸€ä¸ªæå‡ã€‚

### ç¾Šé©¼ç³»æ¨¡å‹

å‚è€ƒï¼š

- [Guanaco, Llama, VicuÃ±a, Alpacaè¯¥æ€ä¹ˆåŒºåˆ«](https://zhuanlan.zhihu.com/p/106262896)
- [å¤§æ¨¡å‹å…¥é—¨ï¼ˆä¸€ï¼‰â€”â€” LLaMa/Alpaca/Vicuna](https://www.cnblogs.com/jiangxinyang/p/17310398.html)
- https://blog.csdn.net/v_JULY_v/article/details/129709105

Vicunaæ˜¯åœ¨LLaMa-13Bçš„åŸºç¡€ä¸Šä½¿ç”¨ç›‘ç£æ•°æ®å¾®è°ƒå¾—åˆ°çš„æ¨¡å‹ï¼Œæ•°æ®é›†æ¥è‡ªäºShareGPT.com äº§ç”Ÿçš„ç”¨æˆ·å¯¹è¯æ•°æ®ï¼Œå…±70Kæ¡ã€‚ä½¿ç”¨Pytorch FSDPåœ¨8å¼ A100ä¸Šè®­ç»ƒäº†ä¸€å¤©ã€‚ç›¸è¾ƒäºAlpacaï¼ŒVicunaåœ¨è®­ç»ƒä¸­å°†åºåˆ—é•¿åº¦ç”±512æ‰©å±•åˆ°äº†2048ï¼Œå¹¶ä¸”é€šè¿‡æ¢¯åº¦æ£€æµ‹å’Œflash  attentionæ¥è§£å†³å†…å­˜é—®é¢˜ï¼›è°ƒæ•´è®­ç»ƒæŸå¤±è€ƒè™‘å¤šè½®å¯¹è¯ï¼Œå¹¶ä»…æ ¹æ®æ¨¡å‹çš„è¾“å‡ºè¿›è¡Œå¾®è°ƒã€‚é€šè¿‡GPT4æ¥æ‰“åˆ†è¯„æµ‹ï¼ŒVicunaå¯ä»¥è¾¾åˆ°ChatGPT 90%çš„æ•ˆæœã€‚å¹¶ä¸”è¿˜æä¾›äº†å¯è°ƒç”¨çš„åˆ†å¸ƒå¼èŠå¤©æœåŠ¡[FastChat](https://github.com/lm-sys/FastChat)ã€‚ã€€ã€€

ä¸€äº›æ¨¡å‹å›¾æ ‡çš„åŒºåˆ†ï¼šhttps://kaiyuan.blog.csdn.net/article/details/131467606



















## bug1 æ— æ³•æ‰¾åˆ°æ˜¾å¡é©±åŠ¨

```bash
(base) root@msy-System-Product-Name:~# docker run -d --gpus all -p 80:8501 registry.cn-beijing.aliyuncs.com/chatchat/chatchat:0.2.0
4bcc140c4c5b24e21da7ba6bf863d372f899ddd20e141469959b08ac45b5cf5a
docker: Error response from daemon: could not select device driver "" with capabilities: [[gpu]].
```

è§£å†³è¯¥bug

---

è¿™ä¸ªé”™è¯¯é€šå¸¸å‘ç”Ÿåœ¨ Docker æ— æ³•åœ¨ä½ çš„æœºå™¨ä¸Šæ‰¾åˆ°æ­£ç¡®çš„é©±åŠ¨ç¨‹åºæ¥ä½¿ç”¨ GPU çš„æƒ…å†µä¸‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„æ­¥éª¤ï¼š

1. **æ£€æŸ¥Dockerç‰ˆæœ¬æ˜¯å¦æ”¯æŒ --gpus é€‰é¡¹**

   Dockerä»19.03ç‰ˆæœ¬å¼€å§‹æ”¯æŒåŸç”Ÿä½¿ç”¨GPUã€‚ç”¨å‘½ä»¤ `docker --version` æ£€æŸ¥Dockerç‰ˆæœ¬ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ›´æ—§çš„ç‰ˆæœ¬ï¼Œè€ƒè™‘æ›´æ–°Dockerè‡³æœ€æ–°ç‰ˆæœ¬ã€‚ 

2. **æ£€æŸ¥æ˜¯å¦å®‰è£…äº† NVIDIA å®¹å™¨å·¥å…·ç®±**

   å¦‚æœä½ åœ¨dockerä¸­ä½¿ç”¨GPUï¼Œä½ éœ€è¦å®‰è£…nvidia-docker2ï¼Œå¹¶åœ¨ä½ çš„dockeré…ç½®ä¸­æ·»åŠ NVIDIAè¿è¡Œæ—¶ã€‚å¦‚æœæ²¡æœ‰å®‰è£…ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œå®‰è£… 



a. **ç§»é™¤æ—§ç‰ˆæœ¬**

æ—§ç‰ˆæœ¬çš„ Docker ç”±åä¸º `nvidia-docker2` çš„åŒ…æ”¯æŒã€‚æ–°çš„ Docker ç‰ˆæœ¬ç”± NVIDIA å®¹å™¨å·¥å…·ç®±æ”¯æŒã€‚å¦‚æœä½ å·²ç»å®‰è£…äº†æ—§çš„ `nvidia-docker2` åŒ…ï¼Œè¯·ç§»é™¤å®ƒï¼š

```bash
sudo apt-get purge -y nvidia-docker
```

b. **å®‰è£… NVIDIA å®¹å™¨å·¥å…·ç®±** - æ·»åŠ åŒ…å­˜å‚¨åº“ï¼š

```bash
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update
sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker
```

c. **æµ‹è¯• NVIDIA Docker å®‰è£…** - é€šè¿‡è¿è¡Œä¸€ä¸ªç¤ºä¾‹æ¥æµ‹è¯• NVIDIA Docker çš„å®‰è£…æ˜¯å¦æˆåŠŸï¼š

```bash
docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
```



1. å¦‚æœä»ç„¶å­˜åœ¨ç›¸åŒçš„é”™è¯¯ï¼Œé‚£ä¹ˆä½ åº”è¯¥æ£€æŸ¥Dockeræ˜¯å¦å¯ä»¥è®¿é—®GPUã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œå‘½ä»¤ `nvidia-smi` æ¥æ£€æŸ¥ã€‚å¦‚æœä½ å¯ä»¥çœ‹åˆ°ä½ çš„GPUåˆ—è¡¨ï¼ŒDockerä¹Ÿåº”è¯¥èƒ½å¤Ÿä½¿ç”¨å®ƒä»¬ã€‚ 
2. ç¡®ä¿æ‚¨çš„æœºå™¨ä¸Šæ­£ç¡®å®‰è£…äº† NVIDIA é©±åŠ¨ç¨‹åºã€‚æ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤ `nvidia-smi` æ¥éªŒè¯ã€‚ 

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›æ›´å¤šä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘èƒ½æ›´æ·±å…¥åœ°å¸®åŠ©ä½ ã€‚

## bug2 å›ç­”ä¸ºç©º

ç¾¤é‡Œå¦ä¸€ä¸ªç”¨ docker æ–¹å¼çš„ï¼Œä¹Ÿé‡åˆ°äº†ç›¸åŒçš„é—®é¢˜ã€‚å†³å®šæ”¾å¼ƒdockeræ–¹æ¡ˆï¼Œè½¬æ‰‹åŠ¨éƒ¨ç½²ã€‚ä½†æˆ‘ä¸æƒ³é‡æ–°ä¸‹è¿™äº›æ¨¡å‹åŒ…äº†ï¼Œå°±åœ¨åŸdockerçš„åŸºç¡€ä¸Šé‡æ–°éƒ¨ç½²å§

åŸ

```bash
docker run -d --gpus all -p 80:8501 registry.cn-beijing.aliyuncs.com/chatchat/chatchat:0.2.0
```

ç°

```bash
# å¯é€‰ï¼Œåˆ æ‰æ—§çš„docker
docker stop xxx
dcker rm xxx

docker run -d --name=chatchat2 --restart=always -p 80:8501 f224e85162da

docker exec -it chatchat2 /bin/bash
```

## bug3 gité—®é¢˜

```bash
(base) root@msy-System-Product-Name:~/chatchat# git clone https://huggingface.co/moka-ai/m3e-base
æ­£å…‹éš†åˆ° 'm3e-base'...
remote: Enumerating objects: 108, done.
remote: Counting objects: 100% (16/16), done.
remote: Compressing objects: 100% (15/15), done.
remote: Total 108 (delta 6), reused 0 (delta 0), pack-reused 92
æ¥æ”¶å¯¹è±¡ä¸­: 100% (108/108), 194.12 KiB | 2.55 MiB/s, å®Œæˆ.
å¤„ç† delta ä¸­: 100% (57/57), å®Œæˆ.
```

git cloneå¡åœ¨è¿™ä¸€æ­¥

å°è¯•ç”¨å®‰è£… Git LFS è§£å†³è¯¥é—®é¢˜ã€‚

åœ¨ Ubuntu ä¸Šå®‰è£… Git LFS å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

æ—§ï¼š

```bash
# å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…
$ sudo apt-get install git

# ä¸‹è½½å¹¶å®‰è£…git-lfs
$ curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
$ sudo apt-get install git-lfs

# åˆå§‹åŒ–git-lfs
$ git lfs install
```

æ–°ï¼š

è§å®˜ç½‘é“¾æ¥

ä½†çœ‹èµ·æ¥æ²¡æˆåŠŸ

```bash
(base) root@msy-System-Product-Name:~/chatchat# git lfs install
Error: Failed to call git rev-parse --git-dir: exit status 128
Git LFS initialized.
```

åæ¥ç›´æ¥å¤åˆ¶é»è´´äº†ï¼Œä¸gitäº†ã€‚å…¶å®å°±æ˜¯10Gçš„gitæ—¶é—´å¤ªæ…¢äº†è€Œå·²ã€‚è€å¿ƒç­‰ä¹Ÿå¯ä»¥ï¼Œæˆ‘é€‰æ‹©å…ˆç”¨æœ‰çº¿ä¸‹è½½å†ç”¨wifiä¼ è¿‡å»

## bug4 æ‰¾ä¸åˆ°å­˜åœ¨çš„è·¯å¾„

```bash
FileNotFoundError: [Errno 2] No usable temporary directory found in ['/tmp', '/var/tmp', '/usr/tmp', '/root/chatchat/Langchain-Chatchat']
```

ä½†è·¯å¾„éƒ½æ˜¯çœŸå®å­˜åœ¨çš„

åæ¥å‘ç°åº”è¯¥æ˜¯æˆ‘ç¡¬ç›˜ç©ºé—´æ»¡äº†çš„åŸå› 

## bug5 ä¸€ç›´å¡åœ¨ wait controller running

åˆ†æ­¥è¿è¡Œä¸­ï¼Œç”¨ ` python server/llm_api_stale.py` åˆ™ä¸€ç›´å¡åœ¨wait controller running

æ¢ç”¨å›ä¸€é”®å¯åŠ¨çš„å‘½ä»¤ï¼Œç¾¤å‹è¯´é‚£ä¸ªåˆ†æ­¥å¯ç”¨çš„å¯èƒ½å®˜æ–¹è¦ä¸ç»´æŠ¤äº†

## bug6 çˆ†æ˜¾å­˜

é‡å¯ç”µè„‘è§£å†³













































