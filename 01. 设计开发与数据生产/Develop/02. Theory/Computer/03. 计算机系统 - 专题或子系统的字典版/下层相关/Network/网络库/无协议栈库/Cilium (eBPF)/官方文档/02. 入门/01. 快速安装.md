# [Cilium]()

# ç›®å½•

# å¿«é€Ÿå®‰è£…

æœ¬æŒ‡å—å°†å¼•å¯¼æ‚¨å®Œæˆå¿«é€Ÿé»˜è®¤å®‰è£…ã€‚å®ƒå°†è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨æ‚¨æ­£åœ¨ä½¿ç”¨çš„ Kubernetes å‘è¡Œç‰ˆçš„æœ€ä½³é…ç½®ã€‚æ‰€æœ‰çŠ¶æ€å‡ä½¿ç”¨ Kubernetes è‡ªå®šä¹‰èµ„æºå®šä¹‰ (CRD) å­˜å‚¨ã€‚

å¯¹äºå¤§å¤šæ•°ç”¨ä¾‹æ¥è¯´ï¼Œè¿™æ˜¯æœ€ä½³å®‰è£…æ–¹æ³•ã€‚å¯¹äºå¤§å‹ç¯å¢ƒï¼ˆ> 500 ä¸ªèŠ‚ç‚¹ï¼‰æˆ–è€…å¦‚æœæ‚¨æƒ³è¦è¿è¡Œç‰¹å®šçš„æ•°æ®è·¯å¾„æ¨¡å¼ï¼Œè¯·å‚é˜… [å…¥é—¨æŒ‡å—](https://docs.cilium.io/en/stable/#getting-started) ã€‚

å¦‚æœæ‚¨åœ¨å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‚é˜… [æ•…éšœæ’é™¤éƒ¨åˆ†](https://docs.cilium.io/en/stable/network/kubernetes/troubleshooting/#troubleshooting-k8s)  å’Œ/æˆ–åœ¨ [Slack é¢‘é“](https://docs.cilium.io/en/stable/glossary/#term-Slack-channel) ä¸Šå¯»æ±‚å¸®åŠ©ã€‚

## åˆ›å»ºé›†ç¾¤

å¦‚æœæ‚¨è¿˜æ²¡æœ‰ Kubernetes é›†ç¾¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯´æ˜åœ¨æœ¬åœ°æˆ–ä½¿ç”¨æ‰˜ç®¡ Kubernetes æœåŠ¡åˆ›å»º Kubernetes é›†ç¾¤ï¼š

### GKE

### AKS

### EKS (äºšé©¬é€Š)

### kind

### minikube

### Rancher Desktop

### Alibaba ACK (é˜¿é‡Œ)

### å…¶ä»–

è…¾è®¯TKE

## å®‰è£… Cilium CLI

> [!WARN]
>
> ç¡®ä¿å®‰è£… cilium-cli v0.15.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å…¶ä½™è¯´æ˜ä¸é€‚ç”¨äºæ—§ç‰ˆæœ¬çš„ cilium-cliã€‚è¦ç¡®è®¤ç³»ç»Ÿä¸­å®‰è£…çš„ cilium-cli ç‰ˆæœ¬ï¼Œè¯·è¿è¡Œï¼š
>
> ```bash
> cilium version --client
> ```
>
> æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… [Cilium CLI å‡çº§è¯´æ˜](https://docs.cilium.io/en/stable/operations/upgrade/#upgrade-cilium-cli-helm-mode)ã€‚

å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Cilium CLIã€‚ Cilium CLI å¯ç”¨äºå®‰è£… Ciliumã€æ£€æŸ¥ Cilium å®‰è£…çš„çŠ¶æ€ä»¥åŠå¯ç”¨/ç¦ç”¨å„ç§åŠŸèƒ½ï¼ˆä¾‹å¦‚ clustermeshã€Hubbleï¼‰ã€‚

< Linux

```bash
CILIUM_CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt)
CLI_ARCH=amd64
if [ "$(uname -m)" = "aarch64" ]; then CLI_ARCH=arm64; fi
curl -L --fail --remote-name-all https://github.com/cilium/cilium-cli/releases/download/${CILIUM_CLI_VERSION}/cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}
sha256sum --check cilium-linux-${CLI_ARCH}.tar.gz.sha256sum
sudo tar xzvfC cilium-linux-${CLI_ARCH}.tar.gz /usr/local/bin
rm cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}
```

< mac

```bash
CILIUM_CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt)
CLI_ARCH=amd64
if [ "$(uname -m)" = "arm64" ]; then CLI_ARCH=arm64; fi
curl -L --fail --remote-name-all https://github.com/cilium/cilium-cli/releases/download/${CILIUM_CLI_VERSION}/cilium-darwin-${CLI_ARCH}.tar.gz{,.sha256sum}
shasum -a 256 -c cilium-darwin-${CLI_ARCH}.tar.gz.sha256sum
sudo tar xzvfC cilium-darwin-${CLI_ARCH}.tar.gz /usr/local/bin
rm cilium-darwin-${CLI_ARCH}.tar.gz{,.sha256sum}
```

< Other

æŸ¥çœ‹ [å‘å¸ƒçš„å®Œæ•´é¡µé¢](https://github.com/cilium/cilium-cli/releases/latest)

> [!NOTE] è§†é¢‘
>
> è¦äº†è§£æœ‰å…³ Cilium CLI çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ eCHO ç¬¬ 8 é›†ï¼šæ¢ç´¢ Cilium CLIï¼š[eCHO episode 8: Exploring the Cilium CLI](https://www.youtube.com/watch?v=ndjmaM1i0WQ&t=1136s)

## å®‰è£… Cilium

æ‚¨å¯ä»¥åœ¨ä»»ä½• Kubernetes é›†ç¾¤ä¸Šå®‰è£… Ciliumã€‚é€‰æ‹©ä»¥ä¸‹é€‰é¡¹ä¹‹ä¸€ã€‚

### Generic

è¿™äº›æ˜¯æœ‰å…³å¦‚ä½•å°† Cilium å®‰è£…åˆ°ä»»ä½• Kubernetes é›†ç¾¤ä¸­çš„é€šç”¨è¯´æ˜ã€‚å®‰è£…ç¨‹åºå°†å°è¯•è‡ªåŠ¨ä¸ºæ‚¨é€‰æ‹©æœ€ä½³é…ç½®é€‰é¡¹ã€‚è¯·å‚é˜…å…¶ä»–é€‰é¡¹å¡ä»¥äº†è§£å‘è¡Œç‰ˆ/å¹³å°ç‰¹å®šè¯´æ˜ï¼Œå…¶ä¸­è¿˜åˆ—å‡ºäº†ç‰¹å®šå¹³å°çš„ç†æƒ³é»˜è®¤é…ç½®ã€‚

è¦æ±‚ï¼š

- Kubernetes å¿…é¡»é…ç½®ä¸ºä½¿ç”¨ CNIï¼ˆè¯·å‚é˜…ç½‘ç»œæ’ä»¶è¦æ±‚ï¼‰
- Linux kernel >= 4.9.17 Linux å†…æ ¸ >= 4.9.17

> [!Tip]
>
> æœ‰å…³  [System Requirements](https://docs.cilium.io/en/stable/operations/system_requirements/#admin-system-reqs)  çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç³»ç»Ÿè¦æ±‚ã€‚

å®‰è£…Ciliumï¼Œå°† Cilium å®‰è£…åˆ°å½“å‰ kubectl ä¸Šä¸‹æ–‡æŒ‡å‘çš„ Kubernetes é›†ç¾¤ä¸­ï¼š

```bash
cilium install --version 1.14.0
```

### GKE

### AKS

### EKS

### OpenShift

### RKE

### k3s

### Alibaba ACK

## å®‰è£…å¤±è´¥æ£€æŸ¥

å¦‚æœå®‰è£…ç”±äºæŸç§åŸå› å¤±è´¥ï¼Œè¯·è¿è¡Œ `cilium status` ä»¥æ£€ç´¢ Cilium éƒ¨ç½²çš„æ•´ä½“çŠ¶æ€å¹¶æ£€æŸ¥ä»»ä½•æ— æ³•éƒ¨ç½²çš„ pod çš„æ—¥å¿—ã€‚

> [!Tip]
>
> æ‚¨å¯èƒ½ä¼šçœ‹åˆ° `cilium install` æ‰“å°å¦‚ä¸‹å†…å®¹ï¼š
>
> ```bash
> â™»ï¸  Restarted unmanaged pod kube-system/event-exporter-gke-564fb97f9-rv8hg
> â™»ï¸  Restarted unmanaged pod kube-system/kube-dns-6465f78586-hlcrz
> â™»ï¸  Restarted unmanaged pod kube-system/kube-dns-autoscaler-7f89fb6b79-fsmsg
> â™»ï¸  Restarted unmanaged pod kube-system/l7-default-backend-7fd66b8b88-qqhh5
> â™»ï¸  Restarted unmanaged pod kube-system/metrics-server-v0.3.6-7b5cdbcbb8-kjl65
> â™»ï¸  Restarted unmanaged pod kube-system/stackdriver-metadata-agent-cluster-level-6cc964cddf-8n2rt
> ```
>
> è¿™è¡¨æ˜æ‚¨çš„é›†ç¾¤åœ¨éƒ¨ç½² Cilium ä¹‹å‰å·²ç»è¿è¡Œäº†ä¸€äº› podï¼Œå¹¶ä¸”å®‰è£…ç¨‹åºå·²è‡ªåŠ¨é‡æ–°å¯åŠ¨å®ƒä»¬ï¼Œä»¥ç¡®ä¿æ‰€æœ‰ pod éƒ½èƒ½è·å¾— Cilium æä¾›çš„ç½‘ç»œã€‚

## éªŒè¯å®‰è£…

è¦éªŒè¯ Cilium æ˜¯å¦å·²æ­£ç¡®å®‰è£…ï¼Œæ‚¨å¯ä»¥è¿è¡Œ

```bash
$ cilium status --wait
   /Â¯Â¯\
/Â¯Â¯\__/Â¯Â¯\    Cilium:         OK
\__/Â¯Â¯\__/    Operator:       OK
/Â¯Â¯\__/Â¯Â¯\    Hubble:         disabled
\__/Â¯Â¯\__/    ClusterMesh:    disabled
   \__/

DaemonSet         cilium             Desired: 2, Ready: 2/2, Available: 2/2
Deployment        cilium-operator    Desired: 2, Ready: 2/2, Available: 2/2
Containers:       cilium-operator    Running: 2
                  cilium             Running: 2
Image versions    cilium             quay.io/cilium/cilium:v1.9.5: 2
                  cilium-operator    quay.io/cilium/operator-generic:v1.9.5: 2
```

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ‚¨çš„é›†ç¾¤æ˜¯å¦å…·æœ‰æ­£ç¡®çš„ç½‘ç»œè¿æ¥ï¼š

```bash
$ cilium connectivity test
â„¹ï¸  Monitor aggregation detected, will skip some flow validation steps
âœ¨ [k8s-cluster] Creating namespace for connectivity check...
(...)
---------------------------------------------------------------------------------------------------------------------
ğŸ“‹ Test Report
---------------------------------------------------------------------------------------------------------------------
âœ… 69/69 tests successful (0 warnings)
```

æ­å–œï¼æ‚¨æ‹¥æœ‰ä¸€ä¸ªå¸¦æœ‰ Cilium çš„åŠŸèƒ½é½å…¨çš„ Kubernetes é›†ç¾¤ã€‚ ğŸ‰

## åç»­æ­¥éª¤

- [è®¾ç½®Hubbleå¯è§‚æµ‹æ€§](https://docs.cilium.io/en/stable/gettingstarted/hubble_setup/#hubble-setup)
- [ä½¿ç”¨ CLI æ£€æŸ¥ç½‘ç»œæµé‡](https://docs.cilium.io/en/stable/gettingstarted/hubble_cli/#hubble-cli)
- [æœåŠ¡åœ°å›¾å’Œ Hubble UI](https://docs.cilium.io/en/stable/gettingstarted/hubble/#hubble-ui)
- [èº«ä»½æ„ŸçŸ¥å’Œ HTTP æ„ŸçŸ¥ç­–ç•¥æ‰§è¡Œ](https://docs.cilium.io/en/stable/security/http/#gs-http)
- [è®¾ç½®é›†ç¾¤ç½‘æ ¼](https://docs.cilium.io/en/stable/network/clustermesh/clustermesh/#clustermesh)







































