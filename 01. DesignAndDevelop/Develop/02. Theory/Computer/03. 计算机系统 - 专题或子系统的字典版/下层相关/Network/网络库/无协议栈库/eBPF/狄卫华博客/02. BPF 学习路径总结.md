# eBPF

# ç›®å½•

# BPF å­¦ä¹ è·¯å¾„æ€»ç»“

## ä¸ºä»€ä¹ˆè¦å­¦ä¹  BPF

å¯ä»¥å…ˆä» [ebpf.io](https://ebpf.io/) ç½‘ç«™è·å–ä¸€ä¸ªç®€å•çš„äº†è§£ï¼Œé¦–é¡µå†…å®¹ç¿»è¯‘å¦‚ä¸‹ã€‚

Linux  å†…æ ¸ä¸€ç›´æ˜¯å®ç°ç›‘æ§/å¯è§‚å¯Ÿæ€§ã€ç½‘ç»œå’Œå®‰å…¨æ€§çš„ç†æƒ³åœºæ‰€ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™å¾€å¾€æ˜¯ä¸åˆ‡å®é™…çš„ï¼Œå› ä¸ºå®ƒéœ€è¦æ”¹å˜å†…æ ¸æºä»£ç æˆ–åŠ è½½å†…æ ¸æ¨¡å—ï¼Œå¹¶å¯¼è‡´å±‚å±‚æŠ½è±¡å åŠ ã€‚eBPF æ˜¯ä¸€é¡¹é©å‘½æ€§çš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥åœ¨ Linux å†…æ ¸ä¸­è¿è¡Œæ²™ç›’ç¨‹åºï¼Œè€Œæ— éœ€æ”¹å˜å†…æ ¸æºä»£ç æˆ–åŠ è½½å†…æ ¸æ¨¡å—ã€‚

é€šè¿‡ä½¿Linuxå†…æ ¸å¯ç¼–ç¨‹ï¼ŒåŸºç¡€æ¶æ„è½¯ä»¶å¯ä»¥åˆ©ç”¨ç°æœ‰çš„å±‚ï¼Œä½¿å…¶æ›´åŠ æ™ºèƒ½ï¼ŒåŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œè€Œä¸ä¼šç»§ç»­ç»™ç³»ç»Ÿå¢åŠ é¢å¤–çš„å¤æ‚åº¦ï¼Œä¹Ÿä¸ä¼šå½±å“æ‰§è¡Œæ•ˆç‡å’Œå®‰å…¨æ€§ã€‚

eBPF å¼€å‘äº†å…¨æ–°ä¸€ä»£çš„è½¯ä»¶ï¼Œèƒ½å¤Ÿå¯¹ Linux å†…æ ¸çš„è¡Œä¸ºè¿›è¡Œé‡æ–°ç¼–ç¨‹ï¼Œç”šè‡³åœ¨ä¼ ç»Ÿä¸Šå®Œå…¨ç‹¬ç«‹çš„å¤šä¸ªå­ç³»ç»Ÿä¸­åº”ç”¨é€»è¾‘ã€‚



BPF æŠ€æœ¯ç›®å‰ä¸»è¦ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š

1.  è¿½è¸ªå’Œæ€§èƒ½åˆ†æï¼ˆTracing & Profilingï¼‰

    å°† eBPF  ç¨‹åºé™„åŠ åˆ°è·Ÿè¸ªç‚¹ä»¥åŠå†…æ ¸å’Œç”¨æˆ·åº”ç”¨æ¢é’ˆç‚¹çš„èƒ½åŠ›ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿæœ¬èº«çš„è¿è¡Œæ—¶è¡Œä¸ºå…·æœ‰å‰æ‰€æœªæœ‰çš„å¯è§æ€§ã€‚é€šè¿‡èµ‹äºˆåº”ç”¨ç¨‹åºå’Œç³»ç»Ÿä¸¤æ–¹é¢çš„æ£€æµ‹èƒ½åŠ›ï¼Œå¯ä»¥å°†ä¸¤ç§è§†å›¾ç»“åˆèµ·æ¥ï¼Œä»è€Œè·å¾—å¼ºå¤§è€Œç‹¬ç‰¹çš„æ´å¯ŸåŠ›æ¥æ’é™¤ç³»ç»Ÿæ€§èƒ½é—®é¢˜ã€‚å…ˆè¿›çš„ç»Ÿè®¡æ•°æ®ç»“æ„å…è®¸ä»¥é«˜æ•ˆçš„æ–¹å¼æå–æœ‰æ„ä¹‰çš„å¯è§æ€§æ•°æ®ï¼Œè€Œä¸éœ€è¦åƒç±»ä¼¼ç³»ç»Ÿé‚£æ ·ï¼Œé€šå¸¸éœ€è¦å¯¼å‡ºå¤§é‡çš„é‡‡æ ·æ•°æ®ã€‚

2.  è§‚æµ‹å’Œç›‘æ§ï¼ˆObervability & Monitoringï¼‰

    eBPF  ä¸ä¾èµ–äºæ“ä½œç³»ç»Ÿæš´éœ²çš„é™æ€è®¡æ•°å™¨å’Œæµ‹é‡ï¼Œè€Œæ˜¯å®ç°äº†è‡ªå®šä¹‰æŒ‡æ ‡çš„æ”¶é›†å’Œå†…æ ¸å†…èšåˆï¼Œå¹¶åŸºäºå¹¿æ³›çš„å¯èƒ½æ¥æºç”Ÿæˆå¯è§æ€§äº‹ä»¶ã€‚è¿™æ‰©å±•äº†å®ç°çš„å¯è§æ€§æ·±åº¦ï¼Œå¹¶é€šè¿‡åªæ”¶é›†æ‰€éœ€çš„å¯è§æ€§æ•°æ®ï¼Œä»¥åŠåœ¨äº‹ä»¶æºå¤„ç”Ÿæˆç›´æ–¹å›¾å’Œç±»ä¼¼çš„æ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯ä¾èµ–æ ·æœ¬çš„å¯¼å‡ºï¼Œå¤§å¤§é™ä½äº†æ•´ä½“ç³»ç»Ÿçš„å¼€é”€ã€‚

3.  ç½‘ç»œï¼ˆNetworkï¼‰

    å¯ç¼–ç¨‹æ€§å’Œæ•ˆç‡çš„ç»“åˆä½¿å¾— eBPF è‡ªç„¶è€Œç„¶åœ°æ»¡è¶³äº†ç½‘ç»œè§£å†³æ–¹æ¡ˆçš„æ‰€æœ‰æ•°æ®åŒ…å¤„ç†è¦æ±‚ã€‚eBPF çš„å¯ç¼–ç¨‹æ€§ä½¿å…¶èƒ½å¤Ÿåœ¨ä¸ç¦»å¼€  Linuxå†…æ ¸çš„åŒ…å¤„ç†ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼Œæ·»åŠ é¢å¤–çš„åè®®è§£æå™¨ï¼Œå¹¶è½»æ¾ç¼–ç¨‹ä»»ä½•è½¬å‘é€»è¾‘ä»¥æ»¡è¶³ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚JIT  ç¼–è¯‘å™¨æä¾›çš„æ•ˆç‡ä½¿å…¶æ‰§è¡Œæ€§èƒ½æ¥è¿‘äºæœ¬åœ°ç¼–è¯‘çš„å†…æ ¸ä»£ç ã€‚

4.  å®‰å…¨ï¼ˆSecurityï¼‰

    åœ¨çœ‹åˆ°å’Œç†è§£æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨çš„åŸºç¡€ä¸Šï¼Œå°†å…¶ä¸æ‰€æœ‰ç½‘ç»œæ“ä½œçš„æ•°æ®åŒ…å’Œå¥—æ¥å­—çº§è§†å›¾ç›¸ç»“åˆï¼Œå¯ä»¥é‡‡ç”¨é©å‘½æ€§çš„æ–°æ–¹æ³•æ¥ç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨ã€‚è™½ç„¶ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ã€ç½‘ç»œçº§è¿‡æ»¤å’Œè¿›ç¨‹ä¸Šä¸‹æ–‡è·Ÿè¸ªç­‰æ–¹é¢é€šå¸¸ç”±å®Œå…¨ç‹¬ç«‹çš„ç³»ç»Ÿå¤„ç†ï¼Œä½† eBPF å…è®¸å°†æ‰€æœ‰æ–¹é¢çš„å¯è§†æ€§å’Œæ§åˆ¶ç»“åˆèµ·æ¥ï¼Œä»¥åˆ›å»ºåœ¨æ›´å¤šä¸Šä¸‹æ–‡ä¸Šè¿è¡Œçš„ã€å…·æœ‰æ›´å¥½æ§åˆ¶æ°´å¹³çš„å®‰å…¨ç³»ç»Ÿã€‚



åœ¨è¿½è¸ªæ–¹é¢ç»†åˆ†ä¸ºäº†ä¸¤ç±»ï¼š

-   è¿½è¸ªå’Œæ€§èƒ½åˆ†æ
-   è§‚æµ‹å’Œç›‘æ§

è¿™ä¸¤è€…çš„åŒºåˆ«ä¸»è¦åœ¨äºæ•°æ®çš„æœé›†å’Œèšåˆæ˜¯å¦åœ¨å†…æµ‹å±‚é¢è¿›è¡Œçš„ï¼Œè§‚æµ‹å’Œç›‘æ§ä¸»è¦æ˜¯ä¾§é‡äºåœ¨å†…æ ¸å¯¼å‡ºæŒ‡æ ‡ã€ç›´æ–¹å›¾æˆ–ç›¸å…³äº‹ä»¶ã€‚

## BPF åº”è¯¥æ€ä¹ˆå­¦ä¹ 

### ä¹¦ç±

#### ä»‹ç»

å¦‚æœæ˜¯æƒ³ç³»ç»Ÿå­¦ä¹  BPF æŠ€æœ¯ï¼Œæˆ‘çš„å»ºè®®æ˜¯å…ˆé˜…è¯»ç›¸å…³çš„ä¹¦ç±ï¼Œå¾—åˆ°ä¸€ä¸ªæ•´ä½“çš„è®¤è¯†ï¼Œç„¶ååˆ†æ–¹å‘å•ç‹¬æ·±å…¥ã€‚

ç›®å‰ BPF çš„ä¹¦ç±ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤æœ¬ï¼š

-   [ã€ŠLinux Observability with BPFã€‹](https://www.amazon.com/Linux-Observability-BPF-Programming-Performance/dp/1492050202)ã€‚ä¸­æ–‡ï¼šå½“å‰å›¾ä¹¦å·²ç»ç¿»è¯‘æˆä¸­æ–‡ï¼Œäº¬ä¸œåœ°å€ï¼š[ã€ŠLinuxå†…æ ¸è§‚æµ‹æŠ€æœ¯BPFã€‹](https://item.jd.com/72110825905.html)ã€‚

    å›¾ä¹¦å…¨åä¸ºï¼šã€ŠLinux Observability with BPF: Advanced Programming for Performance Analysis and Networkingã€‹ã€‚

    æ—©æœŸè¯¥ä¹¦çš„ç”µå­ç‰ˆå¯ä»¥åœ¨ sysdig å®˜ç½‘ä¸‹è½½ï¼Œå›½å†…å¯ä»¥åœ¨[æ­¤å¤„ä¸‹è½½](https://pan.baidu.com/s/10gYYVXOdTX4HQ-_dQfWfOQ)ï¼šé“¾æ¥:  æå–ç : bebtã€‚

    æœ¬ä¹¦ä¸¤ä½ä½œè€…åˆè‘—ï¼š

    -   [ç¾] å¤§å«Â·å¡æ‹‰ç»´æ‹‰ï¼ˆDavid Calaveraï¼‰Netlify çš„ CTOï¼Œæ›¾æ˜¯ Docker çš„ç»´æŠ¤è€…ä»¥åŠ Runcã€Go å’Œ BCC å·¥å…·åŠå…¶ä»–å¼€æºé¡¹ç›®çš„è´¡çŒ®è€…
    -   [æ„] æ´›ä¼¦ä½Â·ä¸°å¡”çº³ï¼ˆLorenzo Fontanaï¼‰Sysdig å¼€æºå›¢é˜Ÿçš„æˆå‘˜ï¼Œä¸»è¦è´Ÿè´£CNCFçš„ Falco é¡¹ç›®ï¼Œè¯¥é¡¹ç›®é€šè¿‡å†…æ ¸æ¨¡å—å’Œ eBPF å®ç°äº†å®¹å™¨è¿è¡Œæ—¶å®‰å…¨å’Œå¼‚å¸¸æ£€æµ‹åŠŸèƒ½ã€‚

-   [ã€ŠBPF Performance Toolsã€‹ ](http://www.brendangregg.com/bpf-performance-tools-book.html)ã€‚ä¸­æ–‡ï¼šè¯¥ä¹¦çš„ä¸­æ–‡ç‰ˆæœ¬å·²ç»å‡ºç‰ˆåœ¨å”®ï¼Œä¸­æ–‡åä¸º ã€ŠBPFä¹‹å·…ï¼šæ´æ‚‰Linuxç³»ç»Ÿå’Œåº”ç”¨æ€§èƒ½ã€‹ï¼Œ JD è´­ä¹°åœ°å€ï¼šhttps://item.jd.com/12769029.html

    å›¾ä¹¦å…¨åä¸ºï¼šã€Š[BPF Performance Tools: Linux System and Application Observability](http://www.brendangregg.com/bpf-performance-tools-book.html)ã€‹

    ä½œè€…ä¸ºå¤§åé¼é¼çš„æ€§èƒ½å¤§å¸ˆ [Brendan Gregg](http://www.brendangregg.com/)ï¼Œè¯¥ä¹¦ç›®å‰è¿˜æ²¡æœ‰ä¸­æ–‡ç‰ˆï¼Œå¦‚æœè´­ä¹°è‹±æ–‡ç‰ˆï¼Œå¯ä»¥ä»[å¤–æ–‡ä¹¦åº—](https://item.jd.com/64536164411.html)ä»£è´­ï¼Œ2-3 å‘¨å¯ä»¥æ”¶åˆ°ã€‚

    ä»–è¿˜å†™è¿‡ä¸€æœ¬æ€§èƒ½ä¼˜åŒ–çš„ç•…é”€ä¹¦ ã€ŠSystems Performance: Enterprise and the Cloudã€‹ï¼Œä¸­æ–‡ç¿»è¯‘ç‰ˆæœ¬ä¸º [ã€Šæ€§èƒ½ä¹‹å·…ï¼šæ´æ‚‰ç³»ç»Ÿã€ä¼ä¸šä¸äº‘è®¡ç®—ã€‹](https://item.jd.com/11755695.html)ã€‚è¯¥ä¹¦çš„ç¬¬äºŒç‰ˆä½œè€…è¿˜åœ¨ä¿®è®¢ä¸­ï¼Œå¯å‚è§ï¼šã€Š[Systems Performance: Enterprise and the Cloud, Second Edition (2020)](http://www.brendangregg.com/systems-performance-2nd-edition-book.html)ã€‹ã€‚

    Brendan Gregg çš„åšå®¢åœ°å€ä¸ºï¼š http://www.brendangregg.com/ï¼Œé‡Œé¢æœ‰å…³äºæ€§èƒ½ä¼˜åŒ–çš„è¯¸å¤šå®è—ï¼Œå€¼å¾—ä»”ç»†å­¦ä¹ å’Œç ”ç©¶ã€‚

#### å›¾ä¹¦å¿ƒå¾—

-   [ã€ŠLinux Observability with BPFã€‹](https://www.amazon.com/Linux-Observability-BPF-Programming-Performance/dp/1492050202)

    ä¸­æ–‡å’Œè‹±æ–‡ç‰ˆéƒ½åœ¨ 180 é¡µå·¦å³ï¼Œæ•´ä½“çš„æ€è·¯æ¸…æ™°ï¼Œç›¸å…³çš„æŠ€æœ¯é¢é¢ä¿±åˆ°ï¼Œå¦‚æœå®šä½æ˜¯æ•´ä½“ç†è§£ï¼ˆè€Œä¸æ˜¯å®è·µç»ƒä¹ ï¼‰ï¼Œæ•´æœ¬ä¹¦é˜…è¯»ä¸€å¤©å†…å¯ä»¥å®Œæˆï¼Œèƒ½å¤Ÿå®ç°å¿«é€Ÿå¯¹äº BPF æŠ€æœ¯çš„æ•´ä½“äº†è§£ï¼Œä½†æ˜¯æœ¬ä¹¦å¯¹äºæ¶‰åŠçš„å†…å®¹ä»‹ç»åŸºæœ¬ä¸Šè¿˜æ˜¯åœç•™åœ¨åŸºç¡€çŸ¥è¯†ä»‹ç»ï¼ŒåŸºæœ¬ä¸Šæ— æ·±å…¥çŸ¥è¯†ä»‹ç»ï¼Œ**ä½œä¸ºå…¥é—¨çº§åˆ«çš„ä¹¦ç±å†åˆé€‚ä¸è¿‡**ã€‚ä¸»è¦å†…å®¹åŒ…æ‹¬ä»¥ä¸‹æ–¹é¢ï¼š

    -   BPF åŸºç¡€çŸ¥è¯†
        -   BPF çš„å†å²åŠæ¶æ„ï¼›
        -   BPF çš„ç¨‹åºç±»å‹å’ŒéªŒè¯å™¨ï¼šæŒ‰ç…§é‡è¦æ€§ä¾æ¬¡ä»‹ç»äº†å„ç§ç¨‹åºç±»å‹ï¼›
        -   BPF Mapï¼š BPF Map ç±»å‹ï¼Œå¸¸è§æ“ä½œå’Œä»¥åŠ Map ç›¸å…³è™šæ‹Ÿç³»ç»Ÿï¼›
    -   BPF Trace
        -   BPF Traceï¼šTrace çš„åŸºç¡€çŸ¥è¯†ï¼ˆkprobeã€tracepointã€usdtç­‰ï¼‰å’Œå‡ ä¸ª BCC ä½¿ç”¨çš„æ ·ä¾‹ï¼›
        -   BPF ç›¸å…³å·¥å…·ï¼ˆBPFTool & BPFTrace & kubectl-trace & eBPF Exportorï¼‰ï¼›
    -   BPF Network
        -   Linux ç½‘ç»œå’Œ BPFï¼šæ¶µç›–æ•°æ®åŒ…è¿‡æ»¤å’Œ cls_bpf ç›¸å…³å†…å®¹ï¼›
        -   XDPï¼šç”±äº XDP åœ¨ç½‘ç»œæ•°æ®å¤„ç†çš„ç‰¹æ®Šåœ°ä½ï¼Œå•ç‹¬æˆç« ï¼Œå¯¹äº XDP è¿›è¡Œäº†ç®€å•ä»‹ç»å’Œä¸€ä¸ªç®€å•çš„åŸç†å®ç°ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ BCC è¿›è¡Œ XDP ç›¸å…³çš„éªŒè¯ï¼›
    -   å®‰å…¨
        -   ä¸»è¦æ˜¯ Seccompï¼ˆåŸºäºä¼ ç»Ÿçš„ cBPFï¼‰å’Œ LSM é’©å­ä¸¤ä¸ªæ–¹é¢çš„å†…å®¹ï¼Œä¸»è¦æ˜¯ç®€å•çš„ä»‹ç»ï¼Œå†…å®¹ä¸å¤šï¼›
    -   çœŸå®çš„ç”¨æˆ·æ¡ˆä¾‹
        -   å›½å¤–å‡ å¤§å…¬å¸ Sysdig ã€Floowmill ç­‰åœ¨ BPF çš„æŠ€æœ¯å®è·µã€‚

-   [ã€ŠBPF Performance Toolsã€‹ ](http://www.brendangregg.com/bpf-performance-tools-book.html)

    æœ¬ä¹¦è‹±æ–‡ç‰ˆ 839 é¡µï¼Œä¸»è¦æ¶‰åŠçš„ BPF æŠ€æœ¯çš„åŸºç¡€ã€BPF Trace åŸºç¡€åŸºç¡€çŸ¥è¯†ã€**BPF æŠ€æœ¯ Trace æ–¹é¢çš„å„ç§å®è·µ**ï¼Œ**æœ¬ä¹¦æ—  BPF åœ¨ç½‘ç»œã€å®‰å…¨ä¸Šçš„è¯¦ç»†ä»‹ç»**ã€‚æœ¬ä¹¦çš„**ä»‹ç»ä¾§é‡äºåŸºç¡€çŸ¥è¯†å’Œåœ¨ Trace å±‚é¢çš„å®è·µ**ï¼Œå¯ä»¥ç†è§£ä¸º ã€ŠSystems Performance: Enterprise and the Cloudã€‹å›¾ä¹¦çš„ä¿®è®¢ç‰ˆæœ¬ï¼Œé‡ç‚¹å¼•å…¥äº† BPF æŠ€æœ¯çš„å®è·µã€‚

    å…¨ä¹¦ä¸»é¢˜åˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼š

    1.  æŠ€æœ¯

        åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸»è¦æ¶‰åŠçš„æ˜¯ BPF ç›¸å…³çš„æŠ€æœ¯å’Œå¦‚ä½•ä½¿ç”¨çš„æ€»è§ˆã€‚

        -   BPF æŠ€æœ¯ä»‹ç»
        -   ğŸ‘ æŠ€æœ¯èƒŒæ™¯
        -   æ€§èƒ½åˆ†ææ€»è§ˆ
        -   BCC å·¥å…·ä»‹ç»
        -   BPFTrace å·¥å…·ä»‹ç»

        è¿™ä¸ªéƒ¨åˆ†çš„å†…å®¹ä»‹ç»ï¼Œé‡ç‚¹åœ¨ `æŠ€æœ¯èƒŒæ™¯` ç« èŠ‚ï¼Œä»‹ç»çš„äº† Trace  ç›¸å…³çš„æŠ€æœ¯ç‚¹åŠå®ç°åŸç†ï¼Œæ€»ç»“çš„éå¸¸ç®€ç»ƒå’Œå‡†ç¡®ï¼Œå€¼å¾—å¤šé˜…è¯»å‡ éï¼› BCC å’Œ BPFTrace  å·¥å…·çš„ä»‹ç»æ›´å¤šæ˜¯ä»åŸç†å’Œä½¿ç”¨å±‚é¢ä»‹ç»ï¼Œè¯¦ç»†çš„çŸ¥è¯†å¯ä»¥ä»ä¸¤è€…çš„ github  ç½‘å€å­¦ä¹ åˆ°ï¼Œè´µåœ¨ç« èŠ‚å†…å®¹æ€»ç»“çš„æœ‰å›¾æœ‰æ¡ç†ï¼Œå¯ä»¥å¿«é€Ÿå¯¹äºæ•´ä½“æ¶æ„æœ‰ä¸ªå¿«é€Ÿçš„è®¤çŸ¥ã€‚

    2.  ä½¿ç”¨ BPF å·¥å…·

        æœ¬ç« èŠ‚ä¸»è¦æ˜¯ä»‹ç»äº†å„ç§æ€§èƒ½åˆ†æç»´åº¦ï¼ˆCPU/Mem/Network/Systemç­‰ï¼‰çš„èƒŒæ™¯çŸ¥è¯†ã€ä¼ ç»Ÿå·¥å…·å’ŒBPF å·¥å…·ä½¿ç”¨ã€‚

        è¿™ä¸ªç« èŠ‚å¯ä»¥ç†è§£æ˜¯ ã€ŠSystems Performance: Enterprise and the Cloudã€‹çš„ç¼©å‡ï¼ˆèƒŒæ™¯çŸ¥è¯†ã€ä¼ ç»Ÿå·¥å…·ï¼‰å’ŒBPF å·¥å…·çš„è¡¥å……ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†ä¸€äº›å¤šçš„å†…å®¹æ¯”å¦‚å®‰å…¨ã€å®¹å™¨å’Œè™šæ‹ŸåŒ–çš„å†…å®¹ã€‚

        è¿™éƒ¨åˆ†çš„å†…å®¹æœ‰æ–¹æ³•è®ºã€åŸºç¡€çŸ¥è¯†å’Œä½¿ç”¨å®è·µï¼Œå¯ä»¥ä½œä¸ºæ—¥å¸¸é—®é¢˜æ’æŸ¥çš„å‚è€ƒå·¥å…·ä¹¦ã€‚

    3.  é™„åŠ ä¸»é¢˜

        ä½œä¸º BPF æ€§èƒ½å·¥å…·çš„è¡¥å……ï¼Œè¿˜æœ‰ä¸€äº›æ˜¯ä½¿ç”¨ BPF å„ç§è¿‡ç¨‹ä¸­çš„å°çŸ¥è¯†ã€æŠ€å·§å’Œå¸¸è§çš„é—®é¢˜ã€‚

    4.  é™„å½•

        è™½ç„¶æ˜¯ä½œä¸ºé™„å½•çš„å†…å®¹ï¼Œä½†æ˜¯å´æ˜¯æˆ‘ä»¬å­¦ä¹ æ·±å…¥æŠ€æœ¯ç‚¹çš„é‡è¦å‚è€ƒï¼Œä¸»è¦æ˜¯ bpftrace å·¥å…·çš„ä¸€è§ˆè¡¨ã€BCC Tools å¼€å‘ã€ä½¿ç”¨åŸç”Ÿçš„ C ç¼–å†™ BPF å’Œ BPF æŒ‡ä»¤é›†ç­‰ã€‚

        è¿™éƒ¨åˆ†çš„å†…å®¹é¢å¯¹çš„æ˜¯å¸Œæœ›å¯¹äº BPF æŠ€æœ¯æ›´åŠ æ·±å…¥äº†è§£å’Œå¸Œæœ›å‚ä¸åˆ° BCC å·¥å…·å¼€å‘çš„ç ”å‘äººå‘˜ã€‚

### BPF å­¦ä¹ æ ·ä¾‹

å¦‚æœæ˜¯ BCC çš„æ ·ä¾‹å¯ä»¥å‚è€ƒ [tools](https://github.com/iovisor/bcc/tree/master/tools) ç›®å½•ä¸‹çš„å…¨éƒ¨æ–‡ä»¶ï¼› BPFTrace ä¹Ÿå¯ä»¥å‚è€ƒ [tools](https://github.com/iovisor/bpftrace/tree/master/tools) ç›®å½•ã€‚

å†…æ ¸ä¸­çš„ BPF æ ·ä¾‹å‚è§ [samples/bpf](https://elixir.bootlin.com/linux/v5.8/source/samples/bpf) å’Œ [testing/bpf](https://elixir.bootlin.com/linux/v5.8/source/tools/testing/selftests/bpf)ï¼Œè¿™éƒ¨åˆ†çš„ä»£ç éƒ½æ˜¯åŸç”Ÿçš„ C ä»£ç ï¼Œæ¯”è¾ƒé€‚åˆå¯¹äº BPF æŠ€æœ¯åŸç†è¿›ä¸€æ­¥æ·±å…¥çš„åŒå­¦ã€‚

å¦‚æœæ˜¯ä¸€å¼€å§‹å­¦ä¹  BPFï¼Œæˆ‘ä¸ªäººçš„å»ºè®®æ˜¯ï¼š

1.  å…ˆå¤§ä½“äº†è§£ BPF æŠ€æœ¯çš„å‘å±•å†å²ã€ä¼˜ç‚¹ã€é™åˆ¶ï¼›
2.  ä½¿ç”¨ BCC å·¥å…·åœ¨ç¯å¢ƒä¸­è¿›è¡Œå®è·µï¼Œå¹¶ä¸”åˆæ­¥äº†è§£ç›¸å…³å·¥å…·çš„çš„è¿ä½œæœºåˆ¶ï¼›
3.  å‚è€ƒ BCC æ ·ä¾‹ï¼Œç”¨åŸç”Ÿçš„ C ä»£ç è¿›è¡Œå®è·µå¹¶ç¼–å†™ï¼›
4.  é€šè¿‡ KubeCon ä¼šè®®æˆ–è€… [BPF Summit](https://ebpf.io/summit-2020) å³°ä¼šå­¦ä¹ å½“å‰ä¸»è¦çš„è¿›å±•å¹¶å­¦ä¹ è·Ÿè¿›æœ€æ–°çš„è¿›å±•ï¼›

å­¦ä¹ æ–¹å¼ä¹Ÿå¯ä»¥å‚è€ƒçš„å¤§å«æçš„ä¸€ç¯‡æ–‡ç«  [Linuxè¶…èƒ½åŠ›BPFæŠ€æœ¯ä»‹ç»åŠå­¦ä¹ åˆ†äº«](https://cloud.tencent.com/developer/article/1698426)ï¼Œå†™çš„å†…å®¹ä¹Ÿæ¯”è¾ƒé½å…¨ï¼Œå¯ä»¥å‚è€ƒ

## BPFèµ„æ–™æ±‡æ€»

å¦‚æœæœ‰å¥½çš„æ–‡ç« æˆ–è€…æ€è·¯åˆ†æï¼Œå¯ä»¥åˆ°æˆ‘çš„ [GitHub Repo](https://github.com/DavadDi/bpf_study) æäº¤ Issueï¼Œåœ°å€ï¼šhttps://github.com/DavadDi/bpf_studyã€‚

### ä»‹ç»ç³»åˆ—

-   ğŸ‘  [https://ebpf.io](https://ebpf.io/)  å®˜æ–¹ç»´æŠ¤çš„ç«™ç‚¹ï¼Œä¸Šé¢çš„èµ„æ–™è¿˜æ˜¯æ¯”è¾ƒå®Œæ•´å’Œæƒå¨çš„
-   ğŸ‘ğŸ‘  [[è¯‘\] å¤§è§„æ¨¡å¾®æœåŠ¡åˆ©å™¨ï¼šeBPF + Kubernetesï¼ˆKubeCon, 2020ï¼‰](http://arthurchiao.art/blog/ebpf-and-k8s-zh/)   BPF Maintainer Daniel çš„å¤§ä½œï¼Œéå¸¸è¯¦ç»†ï¼Œæœ¬æ–‡å†…å®¹çš„æ—¶é—´è·¨åº¦æœ‰ 8 å¹´ï¼Œè¦†ç›–äº† eBPF å‘å±•çš„æ•´ä¸ªå†å²ï¼Œéå¸¸å€¼å¾—ä¸€è¯»ã€‚[pdf](https://github.com/DavadDi/bpf_study/blob/master/BPF-and-Kubernetes-Little-Helper-Minions-for-Scaling-Microservices/Aug19_eBPF_and_Kubernetes_Little_Helper_Minions_for_Scaling_Microservices_Daniel_Borkmann.pdf)
-   ğŸ‘  [[è¯‘\] å¦‚ä½•åŸºäº Cilium å’Œ eBPF æ‰“é€ å¯æ„ŸçŸ¥å¾®æœåŠ¡çš„ Linuxï¼ˆ2019ï¼‰](https://github.com/DavadDi/bpf_study/blob/master/how-to-make-linux-microservice-aware-with-cilium-ebpf/index.md)  [pdf](https://github.com/DavadDi/bpf_study/blob/master/how-to-make-linux-microservice-aware-with-cilium-ebpf/bpf_-_turning_linux_into_a_microservices-aware_operating_system.pdf)
-   An eBPF overview ç³»åˆ—
    -   [part 1: Introduction](https://www.collabora.com/news-and-blog/blog/2019/04/05/an-ebpf-overview-part-1-introduction/)
    -   [part 2: Machine & bytecode](https://www.collabora.com/news-and-blog/blog/2019/04/15/an-ebpf-overview-part-2-machine-and-bytecode/)
    -   [part 3: Walking up the software stack](https://www.collabora.com/news-and-blog/blog/2019/04/26/an-ebpf-overview-part-3-walking-up-the-software-stack/)
    -   [part 4: Working with embedded systems](https://www.collabora.com/news-and-blog/blog/2019/05/06/an-ebpf-overview-part-4-working-with-embedded-systems/)
    -   [part 5: Tracing user processes](https://www.collabora.com/news-and-blog/blog/2019/05/14/an-ebpf-overview-part-5-tracing-user-processes/)
-   [The art of writing eBPF programs: a primer](https://github.com/DavadDi/bpf_study/blob/master/the-art-of-writing-ebpf-programs-a-primer/index.md)
-   [A Deep Dive into eBPF: The Technology that Powers Tracee](https://blog.aquasec.com/intro-ebpf-tracing-containers)
-   [Linux Extended BPF (eBPF) Tracing Tools](http://www.brendangregg.com/ebpf.html) Brendan Gregg
-   [A thorough introduction to eBPF](https://lwn.net/Articles/740157/)
-   [iovisor](https://github.com/iovisor)/**[bpf-docs](https://github.com/iovisor/bpf-docs)**
-   ã€è§†é¢‘ã€‘Linux å†…æ ¸ä¹‹æ—…çš„è§†é¢‘ï¼ŒååŸºç¡€ä¸€äº›
    -   é«˜æ•ˆå…¥é—¨eBPF https://www.bilibili.com/video/BV1LX4y157Gp/
    -   BPF Cç¼–ç¨‹å…¥é—¨ https://www.bilibili.com/video/BV1f54y1h74r/

### æ·±å…¥ç³»åˆ—

-   [Linux å†…æ ¸ BPF æ–‡æ¡£](https://www.infradead.org/~mchehab/kernel_docs/bpf/index.html)
-   bpf å½’æ¡£çš„é‚®ä»¶åˆ—è¡¨ https://lore.kernel.org/bpf/ï¼Œ å®Œæ•´åˆ—è¡¨ http://vger.kernel.org/vger-lists.html
-   ğŸ‘  [Dive into BPF: a list of reading material](https://qmonnet.github.io/whirl-offload/2016/09/01/dive-into-bpf/)ï¼Œä¸­æ–‡å‚è§[è¿™é‡Œ](https://www.zcfy.cc/article/dive-into-bpf-a-list-of-reading-material), åŸºäºè¿™ä¸ªæ–‡æ¡£æœ‰ä½œè€…æ•´ç†äº†ä¸€ä¸ªæ›´åŠ æ¸…æ™°çš„åˆ†ç±» [zoidbergwill/awesome-ebpf](https://github.com/zoidbergwill/awesome-ebpf)  å’Œ [**awesome-ebpf **](https://github.com/icopy-site/awesome-cn/blob/master/docs/awesome/awesome-ebpf.md)- ä¸­æ–‡
-   ğŸ‘ğŸ‘   [Cillum BPF and XDP Reference Guide](https://docs.cilium.io/en/v1.8/bpf/)  [[è¯‘\] Ciliumï¼šBPF å’Œ XDP å‚è€ƒæŒ‡å—ï¼ˆ2019ï¼‰ ](http://arthurchiao.art/blog/cilium-bpf-xdp-reference-guide-zh/)
-   [lwn.net#Berkeley_Packet_Filter](https://lwn.net/Kernel/Index/#Berkeley_Packet_Filter)    lwn.net ç½‘ç«™ä¸­ä¸ BPF ç›¸å…³çš„ä¸»é¢˜æ–‡ç« ï¼Œå¯¹äºäº†è§£ BPF çš„å†å²éå¸¸æœ‰å¸®åŠ©
-   ğŸ‘ğŸ‘  Oracle Blog ç³»åˆ—æ•™ç¨‹ï¼Œæ·±å…¥æµ…å‡ºï¼Œæ˜¯æ·±å…¥å­¦ä¹ çš„å¿…å­¦æ•™ç¨‹
    -   [BPF program types](http://blogs.oracle.com/linux/notes-on-bpf-1)ï¼Œé…åˆ [eBPF features by Linux version](https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md) æ•ˆæœæ›´å¥½
    -   [BPF helper functions for those programs](http://blogs.oracle.com/linux/notes-on-bpf-2)
    -   [BPF userspace communication](http://blogs.oracle.com/linux/notes-on-bpf-3)
    -   [BPF program build environment](http://blogs.oracle.com/linux/notes-on-bpf-4)
    -   [BPF bytecodes and verifier](http://blogs.oracle.com/linux/notes-on-bpf-5)
    -   [BPF Packet Transformation](http://blogs.oracle.com/linux/notes-on-bpf-6)
    -   [The Power of XDP](https://blogs.oracle.com/linux/the-power-of-xdp)
    -   [Notes on BPF (7) - BPF, tc and Generic Segmentation Offload](https://blogs.oracle.com/linux/notes-on-bpf-7)
    -   [Taming Tracepoints in the Linux Kernel](https://blogs.oracle.com/linux/taming-tracepoints-in-the-linux-kernel)
-   ğŸ‘  [xdp-tutorial](https://github.com/xdp-project/xdp-tutorial) é‡Œé¢æœ‰è¯¦ç»†çš„ xdp çš„æºç ï¼Œæ˜¯å­¦ä¹  xdp çš„å¥½åœ°æ–¹
-   ğŸ‘  [[è¯‘\] æ·±å…¥ç†è§£ Cilium çš„ eBPF æ”¶å‘åŒ…è·¯å¾„ï¼ˆdatapathï¼‰ï¼ˆKubeCon, 2019ï¼‰](http://arthurchiao.art/blog/understanding-ebpf-datapath-in-cilium-zh/) [pdf](https://github.com/DavadDi/bpf_study/blob/master/Understanding-the-eBPF-Datapath-in-Cilium/eBPF-and-the-Cilium-Datapath.pdf)

### Linux èµ„æº

-   åœ¨çº¿å†…æ ¸æºç  https://elixir.bootlin.com/























